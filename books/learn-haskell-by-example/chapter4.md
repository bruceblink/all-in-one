---
sidebar_position: 5
typora-root-url: ./..\..\static
---
# ç¬¬ 4 ç«  - è¡Œå·å·¥å…·ï¼ˆLine numbering toolï¼‰
æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š

* ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶
* é€šè¿‡å‡½æ•°å‚æ•°å¯¹é«˜é˜¶å‡½æ•°çš„è¡Œä¸ºè¿›è¡Œå‚æ•°åŒ–
* ä½¿ç”¨ä»£æ•°æ•°æ®ç»“æ„æ¥ç¼–ç å¯é€‰é¡¹
* å°†ä»£ç æ‰“åŒ…ä¸ºå¯æ‰§è¡Œç¨‹åº

åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ºä¸€ä¸ªå¯ä»¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œè¡Œå·ç¼–å·çš„å·¥å…·æ‰“ä¸‹äº†åŸºç¡€ã€‚æˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚ä½•ä»ç”¨æˆ·é‚£é‡Œè¯»å–å‚æ•°ã€‚å› æ­¤ï¼Œç°åœ¨å¯ä»¥å¼€å§‹è€ƒè™‘å¦‚ä½•ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œä»¥åŠå¦‚ä½•è·å–æ–‡ä»¶å†…å®¹ä¸­çš„å„ä¸ªè¡Œã€‚

æœ¬ç« å°†ä»â€œè¯»å–æ–‡ä»¶å¹¶è½¬æ¢å†…å®¹â€å¼€å§‹ï¼Œç„¶åç¼–å†™ä¸€ä¸ªé€šç”¨å‡½æ•°ï¼Œå…¶æ§åˆ¶æµä¸æ•°æ®æµç”±ä½œä¸ºå‚æ•°ä¼ å…¥çš„å‡½æ•°å†³å®šã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ä»£æ•°æ•°æ®ç»“æ„æ¥è¡¨è¾¾ç¨‹åºé€‰é¡¹ï¼Œå¹¶æœ€ç»ˆå®Œæˆä¸Šä¸€ç« ä¸­çš„å·¥å…·ã€‚

## 4.1 æ–‡ä»¶è¯»å–ä¸å†…å®¹è½¬æ¢ï¼ˆReading files and transforming their contentï¼‰

ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰§è¡Œ IO æ“ä½œçš„åŠ¨ä½œã€‚Haskell æä¾›äº†ä¸¤ä¸ªæœ€åŸºæœ¬çš„æ–‡ä»¶æ“ä½œå‡½æ•°ï¼š

```haskell
readFile :: FilePath -> IO String
writeFile :: FilePath -> String -> IO ()
```

é¡¾åæ€ä¹‰ï¼Œ`readFile` ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼Œå¹¶å°†æ•´ä¸ªæ–‡ä»¶å†…å®¹ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ï¼›è€Œ `writeFile` æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶å°†å…¶å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚

è¿™é‡Œæˆ‘ä»¬åˆä¸€æ¬¡çœ‹åˆ°ä½¿ç”¨ç±»å‹åŒä¹‰è¯ï¼ˆå¦‚ `FilePath`ï¼‰çš„æ„ä¹‰ã€‚ä»…ä»ç±»å‹åå°±èƒ½æ˜ç¡®çŸ¥é“å‚æ•°çš„å«ä¹‰ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ `String` ç±»å‹ï¼Œè¿™ä¸€ç‚¹å°±ä¸å¤ªæ˜æ˜¾ã€‚ä»…é€šè¿‡ç±»å‹å£°æ˜ï¼Œæˆ‘ä»¬å°±èƒ½æ¨æ–­å‡ºè¿™äº›å‡½æ•°çš„å¤§è‡´ç”¨é€”ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä½¿ç”¨ `readFile` æ¥æ„å»ºä¸€ä¸ªèƒ½è¿”å›æ–‡ä»¶è¡Œåˆ—è¡¨çš„åŠ¨ä½œã€‚ä¸ºæ­¤ï¼Œéœ€è¦å°†æ–‡ä»¶å†…å®¹æŒ‰æ¢è¡Œç¬¦ `\n` è¿›è¡Œåˆ†å‰²ã€‚å¹¸è¿çš„æ˜¯ï¼ŒHaskell ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç°æˆçš„å‡½æ•° `lines`ï¼Œå®ƒæ­£å¥½å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š

```haskell
ghci> :t lines
lines :: String -> [String]
ghci> lines "Hello\nWorld\n"
["Hello","World"]
```

å¦‚ä½ æ‰€è§ï¼Œ`lines` ä¼šæŠŠå­—ç¬¦ä¸²æŒ‰è¡Œåˆ†å‰²ï¼Œå¹¶è‡ªåŠ¨å»æ‰æ¢è¡Œç¬¦ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªåå‡½æ•° `unlines`ï¼Œå‡ ä¹æ‰§è¡Œç›¸åçš„æ“ä½œï¼š

```haskell
ghci> :t unlines
unlines :: [String] -> String
ghci> unlines ["Hello", "World"]
"Hello\nWorld\n"
ghci> unlines (lines "Hello\nWorld")
"Hello\nWorld\n"
```

`unlines` ä¼šåœ¨æ¯ä¸ªå­—ç¬¦ä¸²åéƒ½åŠ ä¸Šä¸€ä¸ªæ¢è¡Œç¬¦ï¼›è€Œ `lines` åˆ™ä¼šå¿½ç•¥è¾“å…¥å­—ç¬¦ä¸²æœ«å°¾æ˜¯å¦ç¼ºå°‘æ¢è¡Œç¬¦ã€‚

é™¤äº†è¿™ä¸¤ä¸ªå‡½æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰ `words` ä¸ `unwords`ï¼Œå®ƒä»¬å¯ä»¥æŒ‰ç©ºæ ¼åˆ†å‰²ï¼ˆæˆ–é‡æ–°æ‹¼æ¥ï¼‰å­—ç¬¦ä¸²ã€‚æ‰€æœ‰è¿™äº›å‡½æ•°éƒ½åœ¨ `Data.String` æ¨¡å—ä¸­å®šä¹‰ï¼›ä½†æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼å¯¼å…¥ï¼Œå› ä¸ºå®ƒä»¬å·²é€šè¿‡ `Prelude` å¯¼å‡ºï¼Œè€Œ `Prelude` æ˜¯æ¯ä¸ª Haskell ç¨‹åºé»˜è®¤å¯¼å…¥çš„æ¨¡å—ã€‚

> ğŸ’¡ æ³¨æ„ï¼š`Prelude` ä¼šé‡æ–°å¯¼å‡ºæ¥è‡ªä¸åŒæ¨¡å—çš„é‡è¦å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œ`readFile` å’Œ `writeFile` å®é™…ä¸Šæœ€åˆå®šä¹‰äº `System.IO` æ¨¡å—ã€‚ç”±äº `Prelude` é»˜è®¤å¯¼å…¥ï¼Œæˆ‘ä»¬ä¸å¿…æ˜¾å¼å¼•å…¥ `System.IO`ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¯‘å™¨æ ‡å¿—æˆ– pragma ç¦ç”¨ `Prelude` çš„è‡ªåŠ¨å¯¼å…¥ï¼Œä½†é€šå¸¸æ²¡æœ‰å¿…è¦ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªåŠ¨ä½œï¼Œä½¿ç”¨ `readFile` å’Œ `lines` æ¥è¯»å–æ–‡ä»¶çš„æ¯ä¸€è¡Œã€‚æˆ‘ä»¬å…ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼Œç„¶åå°†å…¶ä¼ ç»™ `lines` å‡½æ•°å¹¶è¿”å›ç»“æœã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

```haskell
-- ä»£ç æ¸…å• 4.1ï¼šè¯»å–æ–‡ä»¶è¡Œçš„åŠ¨ä½œ
readLines :: FilePath -> IO [String]
readLines filePath = do
  contents <- readFile filePath      -- #1 è¯»å–æŒ‡å®šè·¯å¾„ä¸‹çš„æ•´ä¸ªæ–‡ä»¶å†…å®¹
  return (lines contents)            -- #2 å°†æ–‡ä»¶å†…å®¹æŒ‰æ¢è¡Œç¬¦åˆ†å‰²ä¸ºè¡Œåˆ—è¡¨
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ­¤æ“ä½œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è¿™å¯¹æˆ‘ä»¬æ¥è¯´æ²¡é—®é¢˜ï¼Œå› ä¸ºé”™è¯¯ä¿¡æ¯è¶³ä»¥æç¤ºç”¨æˆ·å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–å¤„ç†è¿™ç§é”™è¯¯ã€‚

åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `testFile.txt` çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```
Hello
dear
reader!
```

ç„¶åå¯åŠ¨ REPLï¼ˆä½¿ç”¨ `stack repl`ï¼‰ï¼Œæ‰§è¡Œæˆ‘ä»¬çš„åŠ¨ä½œï¼š

```haskell
ghci> readLines "testFile.txt"
["Hello","dear","reader!"]
```

å¾ˆå¥½ï¼ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä¸ºè¿™äº›è¡Œæ·»åŠ è¡Œå·äº†ï¼

### 4.1.1 ç¼–å†™çº¯åº“ï¼ˆWriting a pure libraryï¼‰

ç°åœ¨æˆ‘ä»¬å¯ä»¥æŠŠæ³¨æ„åŠ›è½¬å‘é¡¹ç›®ä¸­çš„ **Lib æ¨¡å—**ã€‚ç”±äºç»™è¡Œç¼–å·çš„ä»£ç æœ¬èº«ç›¸å½“é€šç”¨ï¼Œå› æ­¤ç†åº”ä¿å­˜åœ¨åº“æ¨¡å—ä¸­ã€‚åœ¨å‰é¢ï¼Œæˆ‘ä»¬å·²ç»å¤„ç†äº†ç¨‹åºä¸­çš„è®¸å¤šä¸çº¯ï¼ˆimpureï¼‰éƒ¨åˆ†ï¼Œç°åœ¨å¯ä»¥ä¸“æ³¨äºç¼–å†™çº¯ä»£ç ï¼ˆpure codeï¼‰äº†â€”â€”è¿™éƒ¨åˆ†é€»è¾‘åº”è¯¥æ›´å®¹æ˜“ç†è§£ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¸Œæœ›æ”¯æŒå“ªäº›åŠŸèƒ½ï¼šæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¯¹**æ¯ä¸€è¡Œ**è¿›è¡Œç¼–å·ï¼Œæˆ–ä»…å¯¹**æ»¡è¶³æŸä¸ªæ¡ä»¶**ï¼ˆè°“è¯ï¼‰çš„è¡Œç¼–å·ï¼Œä¾‹å¦‚è¡Œéç©ºæˆ–åŒ…å«æŸä¸ªå­å­—ç¬¦ä¸²ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œèƒ½å¤Ÿä¸ºè¡Œç”Ÿæˆå¯¹åº”çš„è¡Œå·æ˜ å°„ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›æ”¯æŒ**ä¸åŒæ ¼å¼çš„è¡Œå·æ˜¾ç¤º**ï¼Œä¾‹å¦‚å·¦å¯¹é½æˆ–å³å¯¹é½ã€‚ä¸ºæ­¤ï¼Œåœ¨è¿›è¡Œæ ¼å¼åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆæ”¶é›†æ‰€æœ‰è¡Œå·ï¼Œä»¥è®¡ç®—æ‰€éœ€çš„å¡«å……é•¿åº¦ã€‚

æˆ‘ä»¬å…ˆæ€è€ƒå¦‚ä½•ç”¨æ•°æ®ç±»å‹è¡¨ç¤ºè¿™ç§â€œä»è¡Œå·åˆ°è¡Œå†…å®¹â€çš„æ˜ å°„ã€‚æˆ‘ä»¬çŸ¥é“å¿…é¡»æ”¯æŒæŠŠä»»æ„æ•°é‡çš„æ•°å­—æ˜ å°„åˆ°è¡Œå†…å®¹ä¸Šã€‚åŒæ—¶ï¼Œæ˜ å°„çš„é¡ºåºä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬è¦çŸ¥é“æ‰“å°æ—¶çš„é¡ºåºã€‚åˆ—è¡¨ï¼ˆ`List`ï¼‰å‡ ä¹èƒ½æ»¡è¶³æ‰€æœ‰éœ€æ±‚â€”â€”å®ƒå¯ä»¥æœ‰ä»»æ„é•¿åº¦ï¼Œä¸”é¡ºåºå›ºå®šã€‚ä½†é—®é¢˜æ˜¯ï¼š**å¦‚ä½•åœ¨åˆ—è¡¨ä¸­è¡¨ç¤ºä¸€ä¸ªæ˜ å°„ï¼Ÿ**ç­”æ¡ˆå°±æ˜¯**å…³è”åˆ—è¡¨ï¼ˆassociative listï¼‰**ã€‚å…³è”åˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªé”®å€¼æ˜ å°„ã€‚è€Œæœ€ç®€å•çš„é”®å€¼ç»„åˆæ–¹å¼å°±æ˜¯**äºŒå…ƒç»„ï¼ˆtupleï¼‰**ï¼Œå®ƒå¯ä»¥æŠŠä¸¤ä¸ªä¸åŒç±»å‹çš„å€¼æ”¾åœ¨ä¸€èµ·ã€‚

å› æ­¤ï¼Œä¸€ä¸ªå¯èƒ½çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š

```haskell
type NumberedLines = [(Int, String)]
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½ç”¨å®ƒæ¥è¡¨ç¤ºè¡Œå·ä¸è¡Œå†…å®¹çš„å¯¹åº”å…³ç³»ã€‚

> ğŸ’¡ æ³¨æ„
>  å…³è”åˆ—è¡¨éå¸¸çµæ´»ï¼Œå¯ä»¥ç”¨æ¥æ„å»ºå¤šç§æ˜ å°„ç»“æ„ã€‚
>  ä¸è¿‡ï¼Œå®ƒä»¬çš„ç®—æ³•åœ¨è¿è¡Œæ—¶å¤æ‚åº¦ä¸Šé€šå¸¸æ¯”è¾ƒé«˜ï¼Œå› ä¸ºå¤§å¤šæ•°æƒ…å†µä¸‹æŸ¥æ‰¾é”®éƒ½éœ€è¦éå†æ•´ä¸ªåˆ—è¡¨ã€‚
>  ä½†å¦‚æœæ€§èƒ½ä¸æ˜¯ä¸»è¦å…³æ³¨ç‚¹ï¼Œå…³è”åˆ—è¡¨ä¾ç„¶æ˜¯ä¸€ç§éå¸¸æ–¹ä¾¿çš„æ•°æ®ç»“æ„ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```haskell
[(1, "First Line"), (2, "Second Line"), (3, "Third Line")]
```

ä¸è¿‡ï¼Œè¿™ç§è¡¨ç¤ºæ–¹å¼å¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚å› ä¸ºæˆ‘ä»¬å¸Œæœ›èƒ½é€‰æ‹©æ€§åœ°ç»™æŸäº›è¡Œç¼–å·â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº›è¡Œå¯èƒ½**æ²¡æœ‰è¡Œå·**ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§èƒ½è¡¨è¾¾â€œæŸè¡Œå¯èƒ½æ²¡æœ‰ç¼–å·â€çš„ç±»å‹ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»è§è¿‡å¯ä»¥è¡¨ç¤ºâ€œç¼ºå¤±å€¼â€çš„ç±»å‹ï¼š`Maybe`ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ï¼š

```haskell
type NumberedLine = (Maybe Int, String)
type NumberedLines = [NumberedLine]
```

è¿™æ ·ï¼Œä¸€ä¸ªè¡Œå…ƒç´ åŒ…å«ä¸€ä¸ª**å¯é€‰çš„è¡Œå·**å’Œè¡Œå†…å®¹çš„å­—ç¬¦ä¸²ã€‚è€Œæ‰€æœ‰çš„ç¼–å·è¡Œå°±æ˜¯è¿™äº›æ˜ å°„ç»„æˆçš„åˆ—è¡¨ã€‚

> ğŸ’¡ æ³¨æ„
>  åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œ`Maybe` ä¸ä»…èƒ½ç”¨äºæ•è·é”™è¯¯ï¼Œä¹Ÿèƒ½ç”¨äºè¡¨è¾¾â€œå¯é€‰å€¼â€ã€‚
>  è®¸å¤šå…¶ä»–è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼ Haskell `Maybe` çš„ç±»å‹ï¼Œé€šå¸¸è¢«ç§°ä¸º `Option` æˆ–ç±»ä¼¼çš„åå­—ã€‚

------

æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†è¡¨ç¤ºè¡Œå·çš„ç±»å‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘éœ€è¦æ„é€ å“ªäº›å‡½æ•°äº†ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆè¡Œå·ï¼›ä½†å®ƒè¿˜å¿…é¡»èƒ½å¤Ÿ**è·³è¿‡**æŸäº›è¡Œçš„ç¼–å·ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨æ¥æ§åˆ¶**ä½•æ—¶é€’å¢è¡Œå·**â€”â€”å› ä¸ºâ€œè®¡æ•°è¡Œæ•°â€å’Œâ€œç¼–å·è¡Œâ€æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è·³è¿‡ç©ºè¡Œï¼Œä½†**æ˜¯å¦ä»ç„¶è®¡æ•°**è¿™äº›ç©ºè¡Œï¼Ÿå¦‚å›¾ 4.1 æ‰€ç¤ºï¼Œè¿™ä¸¤ç§æ–¹å¼çš„åŒºåˆ«å¾ˆæ˜æ˜¾â€”â€”ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™åº”è¯¥ç”±ç”¨æˆ·è‡ªè¡Œé…ç½®ã€‚

> ![figure4-1](/img/learn-haskell-by-example/chapter4/figure4-1.png)
>
> å›¾ 4.1ï¼šä¸åŒæ–¹å¼çš„ç©ºè¡Œç¼–å·ï¼‰

æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç« å­¦åˆ°çš„ï¼Œé«˜é˜¶å‡½æ•°ï¼ˆhigher-order functionsï¼‰å¯ä»¥æ¥æ”¶å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™äº›å‚æ•°å‡½æ•°èƒ½å¤Ÿæœ‰æ•ˆåœ°å‚æ•°åŒ–å…¶è¡Œä¸ºã€‚
 ç”±äºæˆ‘ä»¬éœ€è¦ä¸ºâ€œä½•æ—¶å¿½ç•¥è¡Œâ€å’Œâ€œä½•æ—¶ç¼–å·â€å®šä¹‰å¤æ‚è§„åˆ™ï¼Œå› æ­¤è¿™æ­£æ˜¯ç¼–å†™**é«˜é˜¶å‡½æ•°**çš„å¥½æœºä¼šâ€”â€”
 è¿™ä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶ä¸¤ä¸ªè°“è¯å‚æ•°ï¼Œåˆ†åˆ«æ§åˆ¶â€œä½•æ—¶é€’å¢ç¼–å·â€å’Œâ€œä½•æ—¶ç»™è¡Œç¼–å·â€ã€‚

### 4.1.2 éšè—è¾…åŠ©å‚æ•°ï¼ˆHiding auxiliary argumentsï¼‰

æˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„æƒ…å†µå¼€å§‹â€”â€”ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œç»™**æ¯ä¸€è¡Œ**ç¼–å·ï¼Œä¸å¸¦ä»»ä½•æ¡ä»¶ã€‚ç„¶åæˆ‘ä»¬å†é€æ­¥æ”¹è¿›ã€‚å…ˆè€ƒè™‘ç±»å‹ï¼šæˆ‘ä»¬æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼ˆå³å„è¡Œæ–‡æœ¬ï¼‰ä½œä¸ºè¾“å…¥ï¼Œéœ€è¦ç”Ÿæˆå‰é¢å®šä¹‰çš„ `NumberedLines`ã€‚é‚£è¡Œå·è®¡æ•°å™¨è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿæˆ‘ä»¬è¦ä¸è¦æŠŠå®ƒä½œä¸ºå‚æ•°æš´éœ²å‡ºå»ï¼Ÿç†æƒ³æƒ…å†µä¸‹ä¸åº”è¯¥â€”â€”å› ä¸ºæˆ‘ä»¬å¸Œæœ›ä» 1 å¼€å§‹ç¼–å·ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³é€’å½’åœ°å®ç°è¿™ä¸ªå‡½æ•°ï¼Œå°±å¿…é¡»æœ‰åŠæ³•åœ¨é€’å½’è°ƒç”¨ä¸­ä¼ é€’â€œé€’å¢åçš„è®¡æ•°å™¨â€ã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ª**åœ¨å¤–éƒ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„éšè—å‡½æ•°**ã€‚å¯ä»¥ä½¿ç”¨ `let` ç»‘å®šæ¥å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

**ä»£ç æ¸…å• 4.2ï¼šåŒ…å«å±€éƒ¨å‡½æ•°å®šä¹‰çš„å‡½æ•°ç»“æ„**

```haskell
numberAllLines :: [String] -> NumberedLines
numberAllLines lines =
  let go :: Int -> [String] -> NumberedLines      -- #1 ä½¿ç”¨ `let` å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å‡½æ•°
      go counter lines = ...
   in go 1 lines                                 -- #2 è°ƒç”¨å±€éƒ¨å‡½æ•°
```

è¿™ä¸æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ `let` ç¨æœ‰ä¸åŒã€‚é‚£æ˜¯å› ä¸º `let` åœ¨ä¸ `do` è¡¨è¾¾å¼é…åˆä½¿ç”¨æ—¶çš„è¯­ä¹‰ä¸ä¸€æ ·ã€‚åœ¨**çº¯å‡½æ•°**ä¸­ï¼Œ`let` ç”¨æ¥åˆ›å»ºå±€éƒ¨å®šä¹‰ï¼ˆè¿™äº›å®šä¹‰å¯ä»¥äº’ç›¸å¼•ç”¨ï¼‰ï¼Œå¹¶é€šè¿‡ `in` å…³é”®å­—å°†å®ƒä»¬å¼•å…¥ä½œç”¨åŸŸï¼Œå¦‚å›¾ 4.2 æ‰€ç¤ºã€‚å®šä¹‰çš„é¡ºåºæ— å…³ç´§è¦ã€‚

> ![figure4-2](/img/learn-haskell-by-example/chapter4/figure4-2.png)
>
> å›¾ 4.2ï¼š`let` ç»‘å®šçš„è¯­æ³•ç»“æ„

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `let` åˆ›å»ºä¸€ä¸ªä¸åŒç±»å‹ç­¾åçš„å†…éƒ¨å‡½æ•°ï¼Œç„¶ååœ¨ä¸»å‡½æ•°ä¸­è°ƒç”¨å®ƒã€‚å†…éƒ¨å‡½æ•°å¯ä»¥æ‹¥æœ‰æ¯”å¤–éƒ¨å‡½æ•°æ›´å¤šï¼ˆæˆ–å®Œå…¨ä¸åŒï¼‰çš„å‚æ•°ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨é€’å½’å‡½æ•°ä¸­**éšè—é»˜è®¤å‚æ•°**ï¼Œæ¯”å¦‚ä¸‹é¢ç¤ºä¾‹ä¸­çš„è®¡æ•°å™¨å˜é‡ã€‚

> ğŸ’¡ æ³¨æ„
>  å½“ä¸ºè¿™ç§å±€éƒ¨å‡½æ•°èµ·åæ—¶ï¼Œé€šå¸¸ä½¿ç”¨ `go` æˆ– `aux`ï¼ˆå³ auxiliary çš„ç¼©å†™ï¼‰ã€‚è¿™è¡¨ç¤ºè¯¥å‡½æ•°åªæ˜¯æŸä¸ªæ›´å¤§å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚

------

ç°åœ¨æˆ‘ä»¬å¯ä»¥é€’å½’åœ°å¢åŠ è®¡æ•°å™¨äº†ã€‚æ¯æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¡Œå·æ˜ å°„ï¼Œå¹¶åœ¨è¡Œå·åŠ ä¸€åç»§ç»­å¤„ç†ä¸‹ä¸€è¡Œã€‚æœ€ç»ˆç»“æœæ˜¯é€šè¿‡è¿æ¥æ–°ç”Ÿæˆçš„æ˜ å°„ï¼ˆ`(Maybe Int, String)` å…ƒç»„ï¼‰ä¸é€’å½’è°ƒç”¨ç»“æœæ„æˆçš„åˆ—è¡¨ã€‚

**ä»£ç æ¸…å• 4.3ï¼šç»™æ¯ä¸€è¡Œç¼–å·çš„å‡½æ•°**

```haskell
numberAllLines :: [String] -> NumberedLines
numberAllLines lines =
  let go :: Int -> [String] -> NumberedLines     -- #1 å±€éƒ¨å‡½æ•°çš„ç±»å‹ç­¾å
      go _ [] = []                               -- #2 å½“è¾“å…¥ä¸ºç©ºåˆ—è¡¨æ—¶è¿”å›ç©ºåˆ—è¡¨ï¼ˆé€’å½’ç»ˆæ­¢æ¡ä»¶ï¼‰
      go counter (x : xs) = (Just counter, x) : go (counter + 1) xs -- #3ä¸ºå½“å‰è¡Œåˆ›å»ºæ–°çš„ç¼–å·æ˜ å°„ï¼Œå¹¶é€’å½’å¤„ç†å‰©ä½™è¡Œ
   in go 1 lines                                 -- #4 è°ƒç”¨è¾…åŠ©å‡½æ•°ï¼Œå¹¶ä¼ å…¥åˆå§‹è¡Œå· 1
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`go` å‡½æ•°åœ¨ç¬¬ä¸€ä¸ªæ¨¡å¼ä¸­ä½¿ç”¨äº†é€šé…ç¬¦ `_` ä½œä¸ºå‚æ•°ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºåœ¨è¿™ä¸€åˆ†æ”¯ï¼ˆç©ºåˆ—è¡¨æƒ…å†µï¼‰ä¸­ä¸éœ€è¦ä½¿ç”¨è®¡æ•°å™¨å˜é‡ï¼Œ
å› æ­¤æˆ‘ä»¬ä¸å¿…ä¸ºå®ƒå‘½åã€‚åœ¨ä¸éœ€è¦æŸä¸ªå‚æ•°æ—¶ä½¿ç”¨ `_` æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¹ æƒ¯ã€‚

------

#### **ç»ƒä¹ ï¼šè¡Œä¸å•è¯ï¼ˆLines and Wordsï¼‰**

`lines`ã€`unlines`ã€`words` å’Œ `unwords` æ˜¯å¤„ç†å­—ç¬¦ä¸²æ—¶éå¸¸æœ‰ç”¨çš„å‡½æ•°ã€‚è¯·å°è¯•ä½¿ç”¨**é€’å½’å®šä¹‰**è‡ªè¡Œå®ç°è¿™äº›å‡½æ•°ï¼è®°ä½ï¼Œ`String` å…¶å®å°±æ˜¯ `Char` çš„åˆ—è¡¨ï¼Œå› æ­¤ä½ å¯ä»¥å¯¹å…¶è¿›è¡Œæ¨¡å¼åŒ¹é…ã€‚åŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `let` åœ¨å‡½æ•°ä¸­å¼•å…¥å¸¦æœ‰é¢å¤–å‚æ•°çš„å†…éƒ¨å®šä¹‰ï¼Œå¹¶é…åˆå®ˆå«ï¼ˆguardsï¼‰æ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå¯ä»¥ç»™ä¼ å…¥çš„æ‰€æœ‰è¡Œç¼–å·çš„å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ GHCi ä¸­æµ‹è¯•å®ƒï¼š

```haskell
ghci> numberAllLines ["Hello", "", "World"]
[(Just 1,"Hello"),(Just 2,""),(Just 3,"World")]
```

## 4.2 é«˜é˜¶å‡½æ•°ä¸­çš„å‚æ•°åŒ–è¡Œä¸ºï¼ˆParametrized behavior in higher-order functionsï¼‰

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è§£å†³æ£€æµ‹ç©ºè¡Œçš„é—®é¢˜ã€‚æˆ‘ä»¬å¸Œæœ›ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªé€‰é¡¹ï¼šæ˜¯å¦ä¸ºè¿™äº›ç©ºè¡Œç¼–å·ã€‚ä½†è¿™æ„å‘³ç€æˆ‘ä»¬é¦–å…ˆè¦èƒ½æ£€æµ‹å‡ºç©ºè¡Œã€‚å½“ç„¶ï¼Œå¦‚æœä¸€è¡Œæ˜¯ç©ºçš„ï¼ˆä¸åŒ…å«ä»»ä½•å­—ç¬¦ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ç©ºè¡Œã€‚ç„¶è€Œï¼Œå¦‚æœè¿™ä¸€è¡ŒåªåŒ…å«æ§åˆ¶å­—ç¬¦ï¼ˆæ— æ³•æ‰“å°ï¼‰æˆ–ç©ºç™½å­—ç¬¦å‘¢ï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æŠŠå®ƒè§†ä¸ºç©ºè¡Œã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ª**è°“è¯å‡½æ•°**ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åº”è¢«è§†ä¸ºç©ºã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿”å›å¸ƒå°”å€¼çš„å‡½æ•°ã€‚è¦æ£€æµ‹å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«æ§åˆ¶å­—ç¬¦æˆ–ç©ºç™½å­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Data.Char` æ¨¡å—ä¸­çš„ä¸€äº›å®ç”¨å‡½æ•°ï¼š

- `isPrint`â€ƒåˆ¤æ–­å­—ç¬¦æ˜¯å¦å¯æ‰“å°ï¼›
- `isSeparator`â€ƒåˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸ºç©ºç™½ç¬¦æˆ–å…¶ä»– Unicode åˆ†éš”ç¬¦ã€‚

```haskell
ghci> import Data.Char
ghci> isPrint 'a'
True
ghci> isPrint '\n'
False
ghci> isSeparator ' '
True
ghci> isSeparator 'a'
False
```

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›å‡½æ•°æ„å»ºä¸€ä¸ªè°“è¯ï¼Œç”¨æ¥æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºæˆ–ä»…ç”±ä¸å¯æ‰“å°å­—ç¬¦ç»„æˆã€‚ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨ `all` å‡½æ•°ï¼Œå®ƒç”¨äºæ£€æŸ¥åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ æ˜¯å¦æ»¡è¶³ç»™å®šè°“è¯ï¼š

```haskell
ghci> all (\x -> x == 1) [1,1,1 :: Int]
True
ghci> all (\x -> x == 1) [1,1,2 :: Int]
False
```

æˆ‘ä»¬å¯ä»¥æ®æ­¤ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼šè‹¥å­—ç¬¦ä¸²ä¸ºç©ºï¼Œæˆ–è€…ä»…åŒ…å«ä¸å¯æ‰“å°å­—ç¬¦æˆ–ç©ºç™½ç¬¦ï¼Œåˆ™è¿”å› `True`ã€‚è¯¥å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š

**ä»£ç æ¸…å• 4.4ï¼šæ£€æµ‹å­—ç¬¦ä¸²ä¸­æ˜¯å¦è‡³å°‘åŒ…å«ä¸€ä¸ªå¯æ‰“å°å­—ç¬¦çš„è°“è¯**

```haskell
isEmpty :: String -> Bool
isEmpty str =
  null str                     -- #1
    || all (\s -> not (isPrint s) || isSeparator s) str   -- #2
```

- \#1â€ƒè‹¥å­—ç¬¦ä¸²ä¸ºç©ºï¼Œåˆ™è¿”å› `True`ï¼›
- \#2â€ƒè‹¥å­—ç¬¦ä¸²ä»…åŒ…å«ä¸å¯æ‰“å°å­—ç¬¦æˆ–åˆ†éš”ç¬¦ï¼Œä¹Ÿè¿”å› `True`ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥æµ‹è¯•è¿™ä¸ªå‡½æ•°ï¼š

```haskell
ghci> isEmpty "Test"
False
ghci> isEmpty "    "
True
ghci> isEmpty "\n  "
True
ghci> isEmpty "A   "
False
```

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰å®ƒçš„å¯¹å¶å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å­—ç¬¦ä¸²**æ˜¯å¦éç©º**ï¼š

```haskell
isNotEmpty :: String -> Bool
isNotEmpty str = not (isEmpty str)
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ä¿®æ”¹è¡Œå·å‡½æ•°ã€‚ç”±äºæˆ‘ä»¬æƒ³åŸºäºå­—ç¬¦ä¸²çš„è°“è¯æ¥æ§åˆ¶æµç¨‹ï¼Œå› æ­¤æˆ‘ä»¬å·²ç»çŸ¥é“æ–°å‡½æ•°å‚æ•°çš„ç±»å‹åº”ä¸º `String -> Bool`ã€‚æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªè°“è¯ï¼š

- ä¸€ä¸ªç”¨äºåˆ¤æ–­æ˜¯å¦åº”é€’å¢è®¡æ•°å™¨ï¼›
- ä¸€ä¸ªç”¨äºåˆ¤æ–­æ˜¯å¦åº”ä¸ºæŸè¡Œç¼–å·ã€‚

æ–°çš„å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```haskell
numberLines :: (String -> Bool) -> (String -> Bool) -> [String] -> NumberedLines
numberLines shouldIncr shouldNumber text = ...
```

æˆ‘ä»¬å°†å‡½æ•°æ”¹åä¸º `numberLines`ï¼Œå› ä¸ºå®ƒç°åœ¨æ˜¯ä¸€ä¸ªé€šç”¨çš„è¡Œç¼–å·å‡½æ•°ã€‚åœ¨å‡½æ•°å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `if-then-else` è¯­å¥åœ¨ `let` ç»‘å®šé‡Œæ§åˆ¶æ˜¯ä¸ºæŸè¡Œç¼–å·ã€æ˜¯å¦é€’å¢è®¡æ•°å™¨ï¼Œæˆ–ä¸¤è€…éƒ½ä¸åšã€‚ä»£ç å¦‚ä¸‹ï¼š

**ä»£ç æ¸…å• 4.5ï¼šé€šç”¨çš„é«˜é˜¶è¡Œç¼–å·å‡½æ•°**

```haskell
numberLines :: (String -> Bool) -> (String -> Bool) -> [String] -> NumberedLines
numberLines shouldIncr shouldNumber text =
  let go :: Int -> [String] -> NumberedLines         -- #1
      go _ [] = []                                  -- #2
      go counter (x : xs) =
        let mNumbering = if shouldNumber x then Just counter else Nothing  -- #3
            newCounter = if shouldIncr x then counter + 1 else counter     -- #4
         in (mNumbering, x) : go newCounter xs                             -- #5
   in go 1 text                                                           -- #6
```

- \#1â€ƒå±€éƒ¨å®šä¹‰çš„å‡½æ•°ç±»å‹ç­¾åï¼›
- \#2â€ƒå½“è¾“å…¥åˆ—è¡¨ä¸ºç©ºæ—¶è¿”å›ç©ºåˆ—è¡¨ï¼Œå³é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼›
- \#3â€ƒè‹¥è°“è¯åˆ¤æ–­åº”ç¼–å·ï¼Œåˆ™ä¸ºå½“å‰è¡Œèµ‹äºˆç¼–å·ï¼›
- \#4â€ƒè‹¥è°“è¯åˆ¤æ–­åº”è®¡æ•°ï¼Œåˆ™é€’å¢è®¡æ•°å™¨ï¼›
- \#5â€ƒä½¿ç”¨æ–°å˜é‡é€’å½’è°ƒç”¨ï¼›
- \#6â€ƒä»¥å›ºå®šåˆå§‹å€¼ `1` è°ƒç”¨è¾…åŠ©å‡½æ•°ã€‚

é€šè¿‡è¿™äº›è°“è¯ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶è®¡æ•°ä¸ç¼–å·è¡Œä¸ºã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬èƒ½åŸºäºè¯¥å‡½æ•°æ„å»ºä¸åŒå˜ä½“ã€‚

### 4.2.1â€ƒéƒ¨åˆ†å‡½æ•°åº”ç”¨ï¼ˆPartial Function Applicationï¼‰

ä¸ºäº†å®šä¹‰ä¸€ä¸ªâ€œç»™æ‰€æœ‰è¡Œç¼–å·â€çš„å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå§‹ç»ˆè¿”å› `True` çš„å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬æ€»æ˜¯æƒ³è®¡æ•°å¹¶ç¼–å·ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š

```haskell
(\_ -> True)
```

è¿™ä¸ªå‡½æ•°ä¼šå¿½ç•¥è¾“å…¥å¹¶å§‹ç»ˆè¿”å› `True`ã€‚ä½†æˆ‘ä»¬è¿˜å¯ä»¥æ›´ä¸€èˆ¬åœ°å†™å‡ºä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå§‹ç»ˆè¿”å›æŸä¸ªå¸¸é‡ï¼Œå¹¶å¿½ç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼š

```haskell
const :: a -> b -> a
const x = (\_ -> x)
```

ç°åœ¨ï¼Œè¡¨è¾¾å¼ `const True` ä¸ä¹‹å‰çš„ `(\_ -> True)` ç­‰ä»·ã€‚æ³¨æ„å®ƒçš„ç±»å‹ç­¾åï¼šæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªè‡ªç”±ç±»å‹å˜é‡ã€‚é€šè¿‡è®©ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹ä¸º `b`ï¼Œæˆ‘ä»¬è¯´æ˜å®ƒå¯ä»¥ä¸ç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹ä¸åŒã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå‡½æ•°æ”¹å†™æˆæ›´å¸¸è§çš„å½¢å¼ï¼š

```haskell
const :: a -> b -> a
const x _ = x
```

è¿™æ ·ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå¯ä»¥ç”Ÿæˆå¸¸é‡ä¸€å…ƒå‡½æ•°çš„é€šç”¨å‡½æ•°ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªå‡½æ•°åœ¨ Haskell ä¸­å·²ç»å­˜åœ¨ï¼äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å®šä¹‰ `numberAllLines`ï¼š

```haskell
numberAllLines :: [String] -> NumberedLines
numberAllLines text = numberLines (const True) (const True) text
```

çœ‹èµ·æ¥æœ‰äº›å¥‡æ€ªï¼š`const True` æ˜æ˜æ˜¯ä¸€ä¸ªäºŒå…ƒå‡½æ•°ï¼Œä¸ºä»€ä¹ˆåªä¼ äº†ä¸€ä¸ªå‚æ•°ï¼Ÿè¿™å°±æ˜¯**éƒ¨åˆ†å‡½æ•°åº”ç”¨**ï¼ˆpartial applicationï¼‰çš„å¨åŠ›ã€‚åœ¨ Haskellï¼ˆä»¥åŠè®¸å¤šå…¶ä»–å‡½æ•°å¼è¯­è¨€ï¼‰ä¸­ï¼Œä½ ä¸å¿…ä¸€æ¬¡æ€§æä¾›å‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼›è‹¥ç¼ºå°‘å‚æ•°ï¼Œè¡¨è¾¾å¼ä¼šè®¡ç®—ä¸ºå¦ä¸€ä¸ªä»ç„¶â€œç­‰å¾…â€ç¼ºå¤±å‚æ•°çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬æœ‰è¡¨è¾¾å¼ `(\x -> f x)` æ—¶ï¼Œå¯ä»¥æ‰§è¡Œ **Î·ï¼ˆetaï¼‰åŒ–ç®€**ï¼šå®ƒä¼šè¢«ç®€åŒ–ä¸º `f`ã€‚è¿™ç§åŒ–ç®€å¯ä»¥é‡å¤åº”ç”¨äºå¤šå‚æ•°å‡½æ•°ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å†™å‡ºæä¸ºç®€æ´çš„å®šä¹‰ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ `const` çš„ä¾‹å­ï¼š `const True` ç­‰ä»·äº `(\_ -> True)`ï¼Œå…¶ç±»å‹ç”± `const :: a -> b -> a` æ¨å¾—ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ `True`ï¼Œæ‰€ä»¥ `a` çš„ç±»å‹æ˜¯ `Bool`ï¼Œæœ€ç»ˆç±»å‹ä¸ºï¼š

```
b -> Bool
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ¥å—ä»»æ„ç±»å‹çš„å‚æ•°å¹¶è¿”å› `Bool`ï¼Œè¿™å®Œå…¨åˆç†ï¼Œå› ä¸ºå‚æ•°è¢«å¿½ç•¥äº†ã€‚

æˆ‘ä»¬ç”šè‡³å¯ä»¥å¯¹ `numberAllLines` å†è¿›è¡Œä¸€æ¬¡ Î· åŒ–ç®€ï¼š

```haskell
numberAllLines :: [String] -> NumberedLines
numberAllLines = numberLines (const True) (const True)
```

ä»ç±»å‹ä¸Šçœ‹ä¹Ÿå®Œå…¨å»åˆï¼š`numberLines` çš„ç±»å‹æ˜¯`(String -> Bool) -> (String -> Bool) -> [String] -> NumberedLines`ï¼Œ
 è€Œ `const True` çš„ç±»å‹æ˜¯ `b -> Bool`ã€‚å°† `b` æ›¿æ¢ä¸º `String` åï¼Œç»“æœç±»å‹æ­£å¥½æ˜¯ `[String] -> NumberedLines`ã€‚

> ğŸ’¡ **æç¤ºï¼š**
>  Î· åŒ–ç®€æ˜¯ä¸€ç§è®©å‡½æ•°å®šä¹‰æ›´ç®€æ´çš„å¥½æ–¹æ³•ã€‚
>  å®ƒåœ¨ Haskell ä»£ç ä¸­æä¸ºå¸¸è§ã€‚è™½ç„¶ä¸æ˜¯å¿…é¡»ä½¿ç”¨ï¼Œä½†ç†Ÿæ‚‰å®ƒèƒ½å¸®åŠ©ä½ æ›´è½»æ¾åœ°é˜…è¯»ä»–äººçš„ä»£ç ã€‚

æˆ‘ä»¬å¯ä»¥æµ‹è¯• `numberAllLines` æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```haskell
numberAllLines ["Hello", "", "World", "!"]
[(Just 1,"Hello"),(Just 2,""),(Just 3,"World"),(Just 4,"!")]
```

ç¡®å®ï¼Œæ‰€æœ‰è¡Œéƒ½è¢«ç¼–å·äº†ã€‚ä½†æˆ‘ä»¬å¹¶éä¸ºäº†è¿™ç§ç®€å•æƒ…å†µæ‰æ³›åŒ–å‡½æ•°â€”â€”è®©æˆ‘ä»¬æ¥å¿½ç•¥ä¸€äº›è¡Œå§ã€‚

**ç»ƒä¹ ï¼šä½¿ç”¨ Î· åŒ–ç®€**

ä¸Šä¸€ç« çš„é¡¹ç›®å®ç°æ—¶æ²¡æœ‰ä½¿ç”¨ Î· åŒ–ç®€ï¼Œä»¥ä¾¿è¯­æ³•æ›´æ˜“ç†è§£ã€‚
 ç°åœ¨ä½ å·²ç»äº†è§£äº†è¿™ç§åŒ–ç®€ï¼Œè¯·æŸ¥çœ‹é¡¹ç›®æºç ï¼Œçœ‹çœ‹å“ªäº›åœ°æ–¹å¯ä»¥è¿›è¡Œ Î· åŒ–ç®€ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼šå®ƒå¯¹æ¯ä¸€è¡Œéƒ½é€’å¢è®¡æ•°å™¨ï¼Œä½†**ä¸ä¸ºç©ºè¡Œç¼–å·**ã€‚æˆ‘ä»¬å¯ä»¥ç»§ç»­ä½¿ç”¨ `numberLines` çš„ä¸¤ä¸ªè°“è¯å‚æ•°ï¼šç¬¬ä¸€ä¸ªåº”å§‹ç»ˆè¿”å› `True`ï¼ˆæ€»æ˜¯è®¡æ•°ï¼‰ï¼Œç¬¬äºŒä¸ªåˆ™åº”æ˜¯æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„â€œéç©ºè¡Œâ€è°“è¯ã€‚

```haskell
numberNonEmptyLines :: [String] -> NumberedLines
numberNonEmptyLines = numberLines (const True) isNotEmpty
```

åŒæ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨ Î· åŒ–ç®€é¿å…å†™å‡º `[String]` å‚æ•°ã€‚æµ‹è¯•å¦‚ä¸‹ï¼š

```haskell
ghci> numberNonEmptyLines ["Hello", "", "World", "!"]
[(Just 1,"Hello"),(Nothing,""),(Just 3,"World"),(Just 4,"!")]
```

æˆ‘ä»¬å§‹ç»ˆé€’å¢è®¡æ•°å™¨ï¼Œä½†ä¸ä¸ºç©ºè¡Œç¼–å·ã€‚å†å†™ä¸€ä¸ªç‰ˆæœ¬ï¼šæ—¢ä¸ä¸ºç©ºè¡Œç¼–å·ï¼Œä¹Ÿä¸åœ¨ç©ºè¡Œä¸Šé€’å¢è®¡æ•°å™¨ã€‚

```haskell
numberAndIncrementNonEmptyLines :: [String] -> NumberedLines
numberAndIncrementNonEmptyLines = numberLines isNotEmpty isNotEmpty
```

æµ‹è¯•ç»“æœï¼š

```haskell
ghci> numberAndIncrementNonEmptyLines ["Hello", "", "World", "!"]
[(Just 1,"Hello"),(Nothing,""),(Just 2,"World"),(Just 3,"!")]
```

è‡³æ­¤ï¼Œæˆ‘ä»¬ä»é€šç”¨å®šä¹‰ï¼ˆä»£ç æ¸…å• 4.5ï¼‰æ´¾ç”Ÿå‡ºäº†ä¸‰ä¸ªåŠŸèƒ½å·®å¼‚æ˜æ˜¾çš„å‡½æ•°ï¼Œæ¦‚è¿°å¦‚ä¸‹ï¼š

**ä»£ç æ¸…å• 4.6ï¼šæ ¹æ®ä¸åŒæ¡ä»¶ä¸ºè¡Œç¼–å·çš„ä¸‰ç§å˜ä½“**

```haskell
numberAllLines :: [String] -> NumberedLines
numberAllLines = numberLines (const True) (const True)          -- #1

numberNonEmptyLines :: [String] -> NumberedLines
numberNonEmptyLines = numberLines (const True) isNotEmpty       -- #2

numberAndIncrementNonEmptyLines :: [String] -> NumberedLines
numberAndIncrementNonEmptyLines = numberLines isNotEmpty isNotEmpty  -- #3
```

- \#1â€ƒä¸ºæ¯ä¸€è¡Œç¼–å·ï¼›
- \#2â€ƒä»…ä¸ºéç©ºè¡Œç¼–å·ï¼Œä½†ç©ºè¡Œä¹Ÿä¼šè®¡æ•°ï¼›
- \#3â€ƒä»…ä¸ºéç©ºè¡Œç¼–å·ï¼Œç©ºè¡Œæ—¢ä¸ç¼–å·ä¹Ÿä¸è®¡æ•°ã€‚

é€šè¿‡è¿™äº›å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œåªéœ€ç¼–å†™ç®€å•çš„å¸ƒå°”è°“è¯ï¼Œå°±èƒ½çµæ´»åœ°æ§åˆ¶ä½•æ—¶ä¸ºè¡Œç¼–å·ã€ä½•æ—¶é€’å¢è¡Œå·ã€‚

## 4.3 ç”¨ä»£æ•°æ•°æ®ç»“æ„è¡¨ç¤ºå„ç§å¯èƒ½æ€§ï¼ˆAlgebraic data structures as an encoding of possibilitiesï¼‰

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªç”¨äºç»™è¡Œç¼–å·çš„å‡½æ•°ï¼Œæ¥ä¸‹æ¥åªéœ€è¦æŠŠå®ƒä»¬æ‰“å°å‡ºæ¥ã€‚æˆ‘ä»¬æœ€åè¦è§£å†³çš„ä¸€ä¸ªé—®é¢˜æ˜¯â€”â€”å¦‚ä½•å°†è¡Œå·è¿›è¡Œ**å·¦å¯¹é½**æˆ–**å³å¯¹é½**å¡«å……ã€‚æˆ‘ä»¬å¸Œæœ›è¿™é‡ŒåŒæ ·é‡‡ç”¨**é€šç”¨çš„æ–¹å¼**ã€‚æ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“éœ€è¦**åœ¨å·¦è¾¹æˆ–å³è¾¹å¡«å……ç©ºæ ¼**ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æƒ³è±¡å†™ä¸€ä¸ª**å‚æ•°åŒ–å‡½æ•°**ï¼Œå®ƒå¯ä»¥æ ¹æ®æŸä¸ªâ€œé€‰é¡¹â€æ¥å†³å®šæ˜¯å·¦å¡«å……è¿˜æ˜¯å³å¡«å……ã€‚ä½†é—®é¢˜æ˜¯ï¼šè¿™ä¸ªâ€œé€‰é¡¹â€è¯¥é•¿ä»€ä¹ˆæ ·ï¼Ÿ

------

### 4.3.1 æ±‚å’Œç±»å‹æˆ–æ ‡è®°è”åˆï¼ˆSum types or tagged unionsï¼‰

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹å‰é¢åœ¨è®¨è®º `Maybe` ç±»å‹æ—¶çœ‹åˆ°çš„ `data` å…³é”®å­—ã€‚æˆ‘ä»¬äº†è§£åˆ°å®ƒå¯ä»¥ç”¨æ¥å®šä¹‰æ–°çš„æ•°æ®ç±»å‹åŠå…¶æ„é€ å™¨ã€‚è¿™äº›æ„é€ å™¨çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯ï¼š**å®ƒä»¬å¯ä»¥è¢«æ¨¡å¼åŒ¹é…**ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç”¨è¿™ç§æ•°æ®ç±»å‹æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„**å’Œç±»å‹ï¼ˆsum typeï¼‰**ï¼Œä»è€Œè¡¨ç¤ºæˆ‘ä»¬æƒ³è¡¨è¾¾çš„ä¸åŒâ€œå˜ä½“â€ã€‚ä¸€ä¸ª**å’Œç±»å‹**ï¼ˆæœ‰æ—¶ç§°ä¸º**æ ‡è®°è”åˆ**ï¼‰æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®ƒç”±æœ‰é™ä¸ª**å›ºå®šç±»å‹çš„æ„é€ å™¨ï¼ˆconstructorï¼‰\**ç»„æˆï¼Œä½†åœ¨ä»»æ„æ—¶åˆ»åªæœ‰å…¶ä¸­\**ä¸€ä¸ª**æ˜¯æœ‰æ•ˆçš„ã€‚è¿™äº›æ„é€ å™¨å¸¦æœ‰åå­—ï¼ˆè¿™ä¹Ÿæ˜¯â€œtagged unionâ€ä¸­â€œtagâ€ä¸€è¯çš„ç”±æ¥ï¼‰ã€‚ä¸ºäº†è¡¨ç¤ºå­—ç¬¦ä¸²å¡«å……çš„ä¸åŒæ–¹å‘ï¼Œæˆ‘ä»¬å¯ä»¥è®©è¿™äº›â€œæ ‡ç­¾â€è¡¨ç¤ºå·¦å¡«å……æˆ–å³å¡«å……ã€‚

**ä»£ç æ¸…å• 4.7ï¼šåŒºåˆ†å·¦å¡«å……ä¸å³å¡«å……çš„ç®€å•ç±»å‹**

```haskell
data PadMode = PadLeft | PadRight
```

è¿™ä¸ªç±»å‹å¦‚ä»£ç æ¸…å• 4.7 æ‰€ç¤ºã€‚ä½ å¯ä»¥è¿™æ ·ç†è§£å®ƒï¼š**`PadMode` è¦ä¹ˆæ˜¯ `PadLeft`ï¼Œè¦ä¹ˆæ˜¯ `PadRight`**ã€‚æˆ‘ä»¬çš„ `pad` å‡½æ•°å¯ä»¥å¯¹è¿™ä¸ªç±»å‹è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼ˆpattern matchï¼‰ï¼Œä»è€Œæ ¹æ®ä¸åŒçš„å€¼å†³å®šå­—ç¬¦ä¸²çš„å¡«å……æ–¹å‘ã€‚å°±åƒä½¿ç”¨ `type` å…³é”®å­—åˆ›å»ºçš„ç±»å‹ä¸€æ ·ï¼Œä½¿ç”¨ `data` å…³é”®å­—åˆ›å»ºçš„ç±»å‹ä¹Ÿå¿…é¡»è¢«æ·»åŠ åˆ°æ¨¡å—çš„å¯¼å‡ºåˆ—è¡¨ä¸­ã€‚è€Œç”±äºè¿™ä¸ªç±»å‹å¸¦æœ‰ä¸¤ä¸ªæ„é€ å™¨ï¼ˆ`PadLeft` å’Œ `PadRight`ï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†å®ƒä»¬ä¸€å¹¶å¯¼å‡ºã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å¯¼å‡ºåˆ—è¡¨ä¸­æ·»åŠ  `PadMode (..)` æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

é‚£ä¹ˆï¼Œ**æˆ‘ä»¬è¯¥å¦‚ä½•å¡«å……å­—ç¬¦ä¸²å‘¢ï¼Ÿ**å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦å°äºæŒ‡å®šçš„ç›®æ ‡é•¿åº¦ï¼Œå°±éœ€è¦åœ¨å®ƒçš„ä¸¤ä¾§æ·»åŠ ç©ºæ ¼ï¼ˆå½“ç„¶ï¼Œå…·ä½“æ˜¯å·¦ä¾§è¿˜æ˜¯å³ä¾§å–å†³äº `PadMode`ï¼‰ï¼Œä»¥ä½¿æœ€ç»ˆå­—ç¬¦ä¸²çš„é•¿åº¦ç­‰äºç›®æ ‡é•¿åº¦ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `replicate` å‡½æ•°ã€‚

```haskell
ghci> :t replicate
replicate :: Int -> a -> [a]

ghci> replicate 10 ' '
"          "
```

è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªæ•´æ•°å’Œä»»æ„ç±»å‹çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­è¯¥å€¼ä¼šè¢«é‡å¤æŒ‡å®šçš„æ¬¡æ•°ã€‚é‚£å¦‚æœå‚æ•°æ˜¯è´Ÿæ•°å‘¢ï¼Ÿ

```haskell
ghci> replicate (-1) 'a'
""
```

ç»“æœæ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`replicate` çš„å®ç°å¾ˆå·§å¦™ï¼šæ˜¾ç„¶ï¼Œè´Ÿé•¿åº¦çš„åˆ—è¡¨æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥å®ƒç›´æ¥è¿”å›ç©ºåˆ—è¡¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°ç”¨å®ƒæ¥è®¡ç®—å­—ç¬¦ä¸²çš„å¡«å……ï¼Œæ— è®ºæ˜¯åœ¨å·¦è¾¹è¿˜æ˜¯å³è¾¹ã€‚
 è®¡ç®—å…¬å¼å¾ˆç®€å•ï¼š

 ```haskell
 replicate (<desired length> - <actual length>) ' '
 ```
 replicate (ç›®æ ‡é•¿åº¦ - å®é™…é•¿åº¦) ' '

äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `let` ç»‘å®šå¿«é€Ÿå†™å‡ºä¸€ä¸ªå‡½æ•°ï¼šå®ƒè®¡ç®—ç›®æ ‡é•¿åº¦ä¸å®é™…é•¿åº¦çš„å·®å€¼ï¼Œç„¶åç”Ÿæˆæ‰€éœ€çš„å¡«å……ï¼š

```haskell
pad :: Int -> String -> String
pad n str =
  let diff = n - length str      -- #1 è®¡ç®—ç›®æ ‡é•¿åº¦ä¸å®é™…é•¿åº¦çš„å·®å€¼
      padding = replicate diff ' '  -- #2 è®¡ç®—æ‰€éœ€çš„å¡«å……ç©ºæ ¼
   in ...
```

------

ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ²¡è€ƒè™‘ `PadMode`ï¼è¿™ä¸ªå‚æ•°åº”è¯¥æ”¾åœ¨å“ªï¼Ÿä¸€ä¸ªåˆç†çš„ç­”æ¡ˆæ˜¯ï¼š**æ”¾åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä½ç½®**ã€‚ä¸ºä»€ä¹ˆï¼Ÿâ€”â€”æƒ³æƒ³**éƒ¨åˆ†å‡½æ•°åº”ç”¨ï¼ˆpartial function applicationï¼‰**ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ¨¡å¼å‚æ•°æ”¾åœ¨æœ€å‰é¢ï¼Œå°±å¯ä»¥ç›´æ¥ä¼ å…¥æ¨¡å¼ï¼ˆä¾‹å¦‚ `PadLeft`ï¼‰ï¼Œç„¶åå¾—åˆ°ä¸€ä¸ªâ€œå¸¦æ–¹å‘çš„â€å¡«å……å‡½æ•°ï¼

æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼š**æ¨¡å¼åŒ¹é…è¯¥æ”¾åœ¨å“ªï¼Ÿ**ç›®å‰æˆ‘ä»¬åªè§è¿‡åœ¨å‡½æ•°å‚æ•°é‡Œåšæ¨¡å¼åŒ¹é…ï¼Œä½†è¿™æ¬¡æˆ‘ä»¬å¸Œæœ›å¤ç”¨å‰é¢ `let` å®šä¹‰çš„å˜é‡ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸ªåˆ†æ”¯ä¸­é‡å¤å®šä¹‰ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `case ... of` è¡¨è¾¾å¼ï¼Œå®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š

```haskell
case <è¡¨è¾¾å¼1> of          -- #1
  <æ¨¡å¼1> -> <è¡¨è¾¾å¼2>     -- #2
  <æ¨¡å¼2> -> <è¡¨è¾¾å¼3>     -- #3
  ...
```

- \#1ï¼šå¼€å§‹åŒ¹é… `<è¡¨è¾¾å¼1>`ã€‚
- \#2ï¼šè‹¥ `<æ¨¡å¼1>` åŒ¹é…æˆåŠŸï¼Œåˆ™ç»“æœæ˜¯ `<è¡¨è¾¾å¼2>` çš„å€¼ã€‚
- \#3ï¼šåŒç†ï¼Œè‹¥ `<æ¨¡å¼2>` åŒ¹é…æˆåŠŸï¼Œåˆ™å– `<è¡¨è¾¾å¼3>` çš„å€¼ã€‚

æ¨¡å¼ä¸æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ä¸€æ ·ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨è¿™ç§è¯­æ³•æ¥åŒ¹é… `PadMode`ï¼ŒæŠŠå®ƒåŠ å…¥åˆ° `pad` å‡½æ•°ä¸­ï¼Œä½¿å¾—å‡½æ•°å¯ä»¥æ ¹æ®æ¨¡å¼åˆ‡æ¢å¡«å……æ–¹å‘ã€‚

**ä»£ç æ¸…å• 4.8ï¼šå¯å·¦å¡«å……æˆ–å³å¡«å……çš„é€šç”¨å‡½æ•°**

```haskell
data PadMode = PadLeft | PadRight        -- #1 å®šä¹‰å·¦å³å¡«å……æ¨¡å¼

pad :: PadMode -> Int -> String -> String
pad mode n str =
  let diff = n - length str              -- #2 è®¡ç®—ç›®æ ‡ä¸å®é™…é•¿åº¦çš„å·®å€¼
      padding = replicate diff ' '       -- #3 è®¡ç®—æ‰€éœ€çš„å¡«å……ç©ºæ ¼
   in case mode of                       -- #4 åŒ¹é…æ¨¡å¼å‚æ•°
        PadLeft -> padding ++ str        -- #5 è‹¥ä¸ºå·¦å¡«å……
        PadRight -> str ++ padding       -- #6 è‹¥ä¸ºå³å¡«å……
```

ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªä¼˜é›…çš„é€šç”¨å¡«å……å‡½æ•°ï¼å°†æ–°å‡½æ•°æ·»åŠ åˆ°æ¨¡å—å¯¼å‡ºåˆ—è¡¨åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ GHCi ä¸­è¯•éªŒï¼š

```haskell
ghci> pad PadLeft 10 "Pad me!"
"   Pad me!"

ghci> pad PadRight 10 "Pad me!"
"Pad me!   "
```

å®Œç¾åœ°å®ç°äº†å·¦å³æ–¹å‘å¯é€‰çš„å¡«å……é€»è¾‘ã€‚

### 4.3.2 ä¸è¦é‡å¤è‡ªå·±ï¼ˆDon't repeat yourselfï¼‰

ç°åœ¨æˆ‘ä»¬å¯ä»¥å†æ¬¡åˆ©ç”¨éƒ¨åˆ†å‡½æ•°åº”ç”¨ä»è¿™ä¸ªéå¸¸é€šç”¨çš„å‡½æ•°æ´¾ç”Ÿå‡ºæ›´å…·ä½“çš„å‡½æ•°ï¼Œå¦‚ä»£ç æ¸…å• 4.9 æ‰€ç¤ºã€‚ä¸ºä»€ä¹ˆè¿™æ ·å†™ä»£ç æ˜¯ä¸€ä¸ªå¥½åŠæ³•ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬ä¸ç”¨é‡å¤è‡ªå·±ï¼ˆDRYï¼‰ï¼Œåœ¨ç¼–ç¨‹ä¸­è¿™å§‹ç»ˆæ˜¯ä¸ªå¥½ç›®æ ‡ã€‚å†è€…ï¼Œè®¾æƒ³æˆ‘ä»¬æƒ³æ·»åŠ ä¸€ä¸ª `PadCenter` æ¨¡å¼ï¼Œä½¿å­—ç¬¦ä¸²åœ¨å·¦å³ä¸¤ä¾§éƒ½è¿›è¡Œå¡«å……ä»¥å®ç°å±…ä¸­æ˜¾ç¤ºã€‚é‚£ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€æ‰©å±•æ•°æ®ç±»å‹å¹¶åœ¨æ¨¡å¼åŒ¹é…ä¸­åŠ å…¥å¦ä¸€ç§åˆ†æ”¯ã€‚å…¶ä»–å®šä¹‰ä»ç„¶å¯ä»¥å¤ç”¨ã€‚è¿™èƒ½èŠ‚çœæ—¶é—´â€”â€”ä¸ç”¨ä¸€æ¬¡åˆä¸€æ¬¡åœ°é‡å®ç°ç›¸åŒé€»è¾‘ã€‚å°½ç®¡å¯¹äºè¿™ä¸ªï¼ˆç›¸å½“ç®€å•çš„ï¼‰ä¾‹å­çœ‹èµ·æ¥å¥½åƒç‰µå¼ºï¼Œä½†åœ¨å®ç°æ›´å¤æ‚çš„å‡½æ•°æ—¶ï¼Œè¿™ç§åšæ³•ç¡®å®èƒ½èŠ‚çœå¤§é‡æ—¶é—´ã€‚è¿˜æœ‰ä¸€ä¸ªå¼•å…¥æ¨¡å¼å‚æ•°ï¼ˆmode parameterï¼‰çš„å¥½å¤„ã€‚å‡è®¾æˆ‘ä»¬æƒ³æ„é€ ä¸€ä¸ªä½¿ç”¨ `pad` å‡½æ•°çš„å‡½æ•°ï¼ˆè¿™æ˜¯æˆ‘ä»¬æƒ³åšçš„ï¼‰ï¼Œä½†å¡«å……æ–¹å¼å¹¶éé¢„å…ˆç¡®å®šã€‚å¦‚ä½•å°†å…¶å‚æ•°åŒ–ï¼Ÿå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰§è¡Œå¡«å……çš„å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä½†ç›´æ¥æä¾› Pad æ¨¡å¼è¦æ›´æ¸…æ™°â€”â€”ä»å‚æ•°ä¸€çœ¼å°±èƒ½çœ‹å‡ºå…¶ç”¨é€”ã€‚

**ä»£ç æ¸…å• 4.9** åŸºäºé€šç”¨å¡«å……å‡½æ•°çš„å·¦å³å¡«å……å‡½æ•°ï¼š

```haskell
padLeft :: Int -> String -> String
padLeft = pad PadLeft                -- #1

padRight :: Int -> String -> String
padRight = pad PadRight              -- #2
```

- \#1 ä»é€šç”¨ `pad` å‡½æ•°ç”Ÿæˆä¸€ä¸ªæ‰§è¡Œå·¦å¡«å……çš„å‡½æ•°ã€‚
- \#2 ä»é€šç”¨ `pad` å‡½æ•°ç”Ÿæˆä¸€ä¸ªæ‰§è¡Œå³å¡«å……çš„å‡½æ•°ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥å¯¹æ•°å­—è¿›è¡Œå¡«å……ï¼Œå‰©ä¸‹çš„å°±æ˜¯æŠŠ `NumberedLines` è½¬æ¢æˆå¯ä»¥æ‰“å°çš„ä¸œè¥¿äº†ï¼

> ç»ƒä¹ ï¼šå®ç°å±…ä¸­å¡«å……
>  æˆ‘ä»¬è®¨è®ºè¿‡å¦‚ä½•æ‰©å±•ä»£ç æ¸…å• 4.8ï¼ˆæ•°æ®ç±»å‹ä¸ `pad` å‡½æ•°ï¼‰ä»¥åˆ›å»ºå±…ä¸­å¡«å……ï¼Œä½¿è¾“å…¥å­—ç¬¦ä¸²è¢«å¡«å……åçœ‹èµ·æ¥ä½äºç»“æœå­—ç¬¦ä¸²çš„ä¸­é—´ã€‚è¯•è¯•å®ç°å®ƒï¼å¯¹æ•´æ•°åšé™¤æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `div` å‡½æ•°ã€‚

### 4.3.3 `zip` å‡½æ•°ï¼ˆThe zip functionï¼‰

ä¸ºäº†å°†æˆ‘ä»¬ç”¨ `numberLines` å‡½æ•°ç”Ÿæˆçš„ `NumberedLines` è½¬æ¢ï¼Œæˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠè¿™ä¸ªä½œä¸ºå…³è”åˆ—è¡¨åŒä¹‰è¯çš„ç±»å‹è½¬æ¢æˆæ›´å®¹æ˜“æ‰“å°çš„å½¢å¼â€”â€”æ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ”¶é›†æ‰€æœ‰è¡Œå·ï¼Œæ‰¾å‡ºæœ€å¤§é•¿åº¦ï¼Œå¯¹è¡Œå·åšç›¸åº”å¡«å……ï¼Œç„¶åæŠŠè¿™äº›è¡Œå·å‰ç½®åˆ°æ¯è¡Œæ–‡æœ¬å‰é¢ã€‚åˆ°è¿™é‡Œéƒ½è¿˜å¥½ï¼›ä½†æˆ‘ä»¬å¤„ç†çš„æ˜¯ä¸€ä¸ªå…ƒç»„åˆ—è¡¨ã€‚æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªåˆ—è¡¨æ‹†å¼€ä»¥è·å¾—å•ç‹¬çš„è¡Œå·ï¼Œç„¶åå†æŠŠå®ƒä»¬åˆå¹¶å›å»ï¼

é¦–å…ˆï¼Œå›é¡¾å¹¶ï¼ˆå†æ¬¡ï¼‰æŠŠæˆ‘ä»¬ä¹‹å‰åšçš„äº‹æƒ…æ³›åŒ–ï¼å‡½æ•° `numberLines` ä½¿ç”¨å¸ƒå°”è°“è¯ä»ç®€å•å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªå…ƒç»„åˆ—è¡¨ï¼ˆç±»å‹ä¸º `(Maybe Int, String)`ï¼‰ã€‚é‚£ä¹ˆæ›´ä¸€èˆ¬åœ°æˆ‘ä»¬å¦‚ä½•æŠŠä¸¤åˆ—åˆ—è¡¨åˆå¹¶æˆå…ƒç»„åˆ—è¡¨ï¼ŸHaskell æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„å‡½æ•° `zip`ï¼Œå…¶ç±»å‹ä¸º `[a] -> [b] -> [(a, b)]`ã€‚æ­£å¦‚æ‹‰é“¾çš„ä¸¤ä¸ªç‰™é½¿åœ¨æ‹‰ä¸Šæ—¶ä¼šé…å¯¹ï¼Œ`zip` æŠŠä¸¤ä¸ªåˆ—è¡¨æŒ‰ä½ç½®åˆå¹¶ä¸ºå…ƒç»„ï¼Œå¹¶åœ¨é‡åˆ°è¾ƒçŸ­çš„é‚£ä¸ªåˆ—è¡¨ç»“å°¾æ—¶åœæ­¢ã€‚è§å›¾ 4.3ã€‚çœ‹å‡ ä¸ªä¾‹å­ï¼š

```haskell
ghci> zip [1,2,3] ["Hello", "World", "!"] :: [(Int, String)]
[(1,"Hello"),(2,"World"),(3,"!")]

ghci> zip [1..10] ['a'..'z'] :: [(Int, Char)]
[(1,'a'),(2,'b'),(3,'c'),(4,'d'),(5,'e'),(6,'f'),(7,'g'),(8,'h'),(9,'i'),
 (10,'j')]

ghci> zip [1..10] [] :: [(Int, Int)]
[]
```



> ![figure4-3](/img/learn-haskell-by-example/chapter4/figure4-3.png)
>
> å›¾ 4.3ï¼šå‰¯ä½œç”¨ã€åŠ¨ä½œä¸çº¯ä»£ç çš„ç›¸äº’ä½œç”¨

`zip` æœ‰ä¸€ä¸ªå‡†é€†æ“ä½œ `unzip`ã€‚å°±åƒ `zip` ç”¨æ¥â€œåˆä¸Šâ€æ‹‰é“¾ï¼Œ`unzip` åˆ™æŠŠå®ƒâ€œæ‰“å¼€â€ï¼š

```haskell
ghci> unzip [(1,'a'), (2,'b'), (3,'c')] :: ([Int], String)
([1,2,3],"abc")

ghci> unzip (zip [1..5] ['a'..'c'] :: ([Int], String))
([1,2,3],"abc")
```

ä¸è¿‡ï¼Œä»è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œ`unzip` å¹¶ä¸æ˜¯ `zip` çš„çœŸæ­£é€†å‡½æ•°ï¼Œå› ä¸º `zip` å¯èƒ½ä¼šèˆå¼ƒè¾ƒé•¿åˆ—è¡¨ä¸­å¤šä½™çš„å…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ã€‚è¿™äº›å‡½æ•°åœ¨å¤„ç†å…³è”åˆ—è¡¨æ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†ä¸€ç§çº¯ä¸”å®‰å…¨çš„æ„é€ ä¸æ‹†è§£å…³è”åˆ—è¡¨çš„æ–¹å¼ã€‚æ—¢ç„¶ `NumberedLines` åªæ˜¯ `[(Maybe Int, String)]` çš„åŒä¹‰è¯ï¼Œå®ƒä»¬å°±æ˜¯æ‹†è§£è¯¥ç±»å‹çš„ä¸é”™é€‰æ‹©ï¼è™½ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡å†™ä¸€ä¸ªä¸“é—¨çš„é€’å½’å‡½æ•°æ¥æ‹†è§£åˆ—è¡¨ï¼Œä½†é‚£æ ·æ—¢å®¹æ˜“å‡ºé”™ï¼Œåˆä¼šäº§ç”Ÿå¤§é‡æœ¬è´¨ç›¸åŒçš„å‡½æ•°ã€‚é€šè¿‡å¤ç”¨å·²æœ‰çš„åŸºæœ¬å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…é‡å¤è‡ªå·±ï¼Œå¹¶ä½¿å‡½æ•°å®šä¹‰æ›´æ˜“è¯»ï¼

ç°åœ¨ï¼Œè¦è®¡ç®—æœ€å¤§è¡Œå·ï¼Œæˆ‘ä»¬éœ€è¦å–å‡ºæ‰€æœ‰è¡Œå·ï¼ŒæŠŠå®ƒä»¬è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼ˆç”¨ `show`ï¼‰ï¼Œè®¡ç®—è¿™äº›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¹¶æ±‚æœ€å¤§å€¼ã€‚è¿™å¯ä»¥å¾ˆç®€æ´åœ°ç”¨ `maximum`ï¼ˆHaskell å·²æä¾›ï¼‰å’Œ `map` å®Œæˆï¼š

```haskell
ghci> xs = [1..1000000] :: [Int]
ghci> maximum (map length (map show xs))
7
```

å†…å±‚çš„ `map` å°†æ•°å­—åˆ—è¡¨è½¬æ¢æˆ `String` åˆ—è¡¨ï¼›å¤–å±‚çš„ `map` è®¡ç®—æ¯ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼›`maximum` è¿”å›å¤–å±‚ `map` äº§ç”Ÿçš„åˆ—è¡¨çš„æœ€å¤§å€¼ã€‚

ç”¨å®ƒæ¥è®¡ç®—è¡Œå·çš„æœ€å¤§é•¿åº¦åï¼Œæˆ‘ä»¬å°±èƒ½ç”Ÿæˆç”¨äºå¡«å……è¡Œå·çš„é•¿åº¦å€¼ã€‚ä½†å¦‚ä½•å°†è¿™äº›è¡Œå·ä¸å®é™…è¡Œå†…å®¹åˆå¹¶ï¼Ÿ`zip` ç”Ÿæˆå…ƒç»„ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›æŠŠä¸¤ä¸ªå…ƒç´ åˆå¹¶æˆä¸€ä¸ª `String`ã€‚è¿™æ—¶éœ€è¦ä¸€ä¸ªé€šç”¨ç‰ˆçš„ `zip`ï¼Œå…è®¸æˆ‘ä»¬æŒ‡å®šå¦‚ä½•åˆå¹¶ä¸¤ä¸ªå…ƒç´ â€”â€”Haskell ä¹Ÿæä¾›äº†è¿™æ ·çš„å‡½æ•° `zipWith`ã€‚

```haskell
ghci> :t zipWith
zipWith :: (a -> b -> c) -> [a] -> [b] -> [c]

ghci> zipWith (+) [1..10] [1..3] :: [Int]
[2,4,6]

ghci> zipWith (\x y -> (show x) ++ ": " ++ y) [1,2,3 :: Int]
                                              ["One", "Two", "Three"] :: [String]
["1: One","2: Two","3: Three"]
```

`zipWith` æ˜¯é«˜é˜¶å‡½æ•°çš„åˆä¸€å…¸å‹ç¤ºä¾‹ï¼šæˆ‘ä»¬åªéœ€ä¼ å…¥ä¸€ä¸ªå‡½æ•°å°±èƒ½å®Œå…¨æ”¹å˜å®ƒçš„è¡Œä¸ºï¼æ­£å¦‚åå­—æ‰€ç¤ºï¼Œå®ƒçš„è¡Œä¸ºç±»ä¼¼äº `zip`ï¼Œä½†ä¼šåœ¨åˆå¹¶å…ƒç´ æ—¶è°ƒç”¨æˆ‘ä»¬æä¾›çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯æ„é€ å…ƒç»„ã€‚

> ç»ƒä¹ ï¼šå®ç° `zipWith`
>  åƒ `map` ä¸€æ ·ï¼Œ`zip` æ˜¯ä»»ä½• Haskell å¼€å‘è€…éƒ½åº”è¯¥ç†Ÿç»ƒæŒæ¡çš„åŸºæœ¬å‡½æ•°ã€‚ä¸ºç†Ÿæ‚‰å®ƒï¼Œå°è¯•ä½¿ç”¨é€’å½’å®ç° `zip`ï¼Œç„¶åæ‰©å±•å®ç° `zipWith`ã€‚é¢å¤–é¢˜ï¼šèƒ½å¦ç”¨ `zipWith` æ¥å®ç° `zip`ï¼Ÿ

### 4.3.4 å¤„ç†ç¼ºå¤±å€¼ï¼ˆWorking with missing valuesï¼‰

æœ€åä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‰¹æ®Šç‚¹æ˜¯ï¼šæˆ‘ä»¬çš„è¡Œå·ç±»å‹ä¸æ˜¯æ™®é€šçš„æ•°å€¼ç±»å‹ï¼Œè€Œæ˜¯ `Maybe Int`ï¼å› æ­¤ï¼Œä¸Šè¿°ç›´æ¥çš„æŠ€æœ¯æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚é—®é¢˜å‡ºåœ¨å“ªé‡Œï¼Ÿåœ¨å¯¹è¡Œå·åš `map` æ—¶ï¼Œæˆ‘ä»¬æ€»å¾—æ£€æŸ¥é‡åˆ°çš„æ˜¯ `Just` è¿˜æ˜¯ `Nothing`ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å­¦åˆ°äº† `maybe` å‡½æ•°ã€‚æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«åœ°å†™å‡ºä¸€ä¸ª `map`ï¼Œå°† `[Maybe Int]` è½¬æ¢æˆ `[String]`ï¼š

```haskell
ghci> ys = [Just 1, Just 2, Nothing, Just 4] :: [Maybe Int]
ghci> map (maybe "" show) ys
["1","2","","4"]
```

è¿™é‡Œæˆ‘ä»¬å†æ¬¡ç”¨äº†éƒ¨åˆ†å‡½æ•°åº”ç”¨ä»¥ç®€åŒ–å®šä¹‰ã€‚å‡­å€Ÿè¿™äº›å·¥å…·å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºæŠŠ `NumberedLines` è½¬æ¢ä¸ºæ¼‚äº®ã€å¯è¯»å­—ç¬¦ä¸²è¡¨ç¤ºçš„å‡½æ•°ï¼Œå¦‚ä¸‹åˆ—å‡ºã€‚

**ä»£ç æ¸…å• 4.10ï¼šå°†ç¼–å·åçš„è¡Œè½¬æ¢ä¸ºäººç±»å¯è¯»å­—ç¬¦ä¸²çš„å‡½æ•°**

```haskell
prettyNumberedLines :: PadMode -> NumberedLines -> [String]
prettyNumberedLines mode lineNums =
  let (numbers, text) = unzip lineNums                      -- #1
      numberStrings = map (maybe "" show) numbers           -- #2
      maxLength = maximum (map length numberStrings)        -- #3
      paddedNumbers = map (pad mode maxLength) numberStrings-- #4
   in zipWith (\n l -> n ++ " " ++ l) paddedNumbers text    -- #5
```

- \#1 å°†å…ƒç»„åˆ—è¡¨æ‹†å¼€ä¸ºä¸€å¯¹åˆ—è¡¨ï¼ˆè¡Œå·åˆ—è¡¨ä¸æ–‡æœ¬åˆ—è¡¨ï¼‰ã€‚
- \#2 æŠŠè¡Œå·è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¹¶å°† `Nothing` æ˜ å°„ä¸ºç©ºå­—ç¬¦ä¸²ã€‚
- \#3 è®¡ç®—æ‰€æœ‰è¡Œå·å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ã€‚
- \#4 å°†æ‰€æœ‰è¡Œå·å­—ç¬¦ä¸²æŒ‰æœ€å¤§é•¿åº¦è¿›è¡Œå¡«å……ï¼ˆä½¿ç”¨ç»™å®šçš„ `mode`ï¼‰ã€‚
- \#5 æŠŠå¡«å……å¥½çš„è¡Œå·ä¸å¯¹åº”æ–‡æœ¬åˆå¹¶ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ° `let` ç»‘å®šä¸­çš„æ¯ä¸ªå®šä¹‰éƒ½æ˜¯æ•´ä½“å‡½æ•°çš„ä¸€éƒ¨åˆ†ã€‚æ¯ä¸ªè¢«ç»‘å®šçš„å€¼åƒæ‹¼å›¾å—ä¸€æ ·ï¼Œç›´åˆ°æœ€åä¸€æ­¥æ‹¼åˆå‡ºæ•´ä¸ªç»“æœã€‚è¿™ä¹Ÿæ¸…æ¥šåœ°å±•ç¤ºäº†å®Œæˆè¯¥æ“ä½œæ‰€éœ€çš„å„ä¸ªè®¡ç®—æ­¥éª¤ï¼šæ‹†å¼€ `NumberedLines`ã€æŠŠè¡Œå·è½¬ä¸ºå­—ç¬¦ä¸²ã€æ‰¾åˆ°æœ€å¤§é•¿åº¦ã€å¯¹è¡Œå·è¿›è¡Œå¡«å……ï¼Œæœ€åæŠŠå®ƒä»¬ç»„åˆæˆæ˜“è¯»çš„å­—ç¬¦ä¸²ã€‚ç¼–å†™å¤„ç†è¾ƒå¤æ‚é—®é¢˜çš„å‡½æ•°æ—¶ï¼ŒæŒ‰è¿™ç§æ–¹å¼æŠŠé—®é¢˜æ‹†åˆ†ä¸ºæ›´å°çš„å­ä»»åŠ¡é€šå¸¸æ˜¯ä¸ªå¥½ä¸»æ„â€”â€”åˆ†æ²»æ³•ä¸ `let` è¯­æ³•é…åˆå¾—éå¸¸å¥½ï¼

> æ³¨ï¼šå‰ç¼€ `pretty` é€šå¸¸ç”¨äºæŠŠæ•°æ®è½¬æ¢ä¸ºâ€œå¯è¯»å½¢å¼â€çš„å‡½æ•°ã€‚

è¿™ä¸ªå‡½æ•°ä¹Ÿå¾ˆå¥½åœ°å±•ç¤ºäº†å£°æ˜å¼ç¼–ç¨‹é£æ ¼ï¼šæˆ‘ä»¬å®šä¹‰äº†ä¸€äº›ä¸­é—´ç»“æœï¼Œå®ƒä»¬å¯ä»¥äº’ç›¸å¼•ç”¨ï¼Œåªæœ‰æœ€ç»ˆè¡¨è¾¾å¼æ‰äº§ç”Ÿæ•´ä¸ªå‡½æ•°çš„æœ€ç»ˆç»“æœã€‚è¿™ç§é£æ ¼ä¸å¯¹è¿™äº›å®šä¹‰è®¡ç®—çš„é¡ºåºåšå‡è®¾â€”â€”è¿™æ˜¯æˆ‘ä»¬åœ¨åç»­ç« èŠ‚ä¸­ä¼šè¿›ä¸€æ­¥æ¢è®¨çš„å†…å®¹ã€‚

### 4.3.5 ä½¿ç”¨ `mapM` æ‰“å°å€¼åˆ—è¡¨ï¼ˆPrinting a list of values with mapMï¼‰

ç°åœ¨ï¼Œç¨‹åºçš„å‡ ä¹æ‰€æœ‰éƒ¨åˆ†éƒ½å·²ç»å¤„ç†å®Œæ¯•ã€‚æœ€åè¦åšçš„æ˜¯æŠŠæ¼‚äº®çš„ç¼–å·è¡Œæ‰“å°åˆ°å±å¹•ä¸Šã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•ï¼Œå¯¹æ¼‚äº®è¡Œåˆ—è¡¨ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²æ‰§è¡Œæ‰“å°ã€‚æƒ³åˆ° `map`ï¼Œå®ƒå¯ä»¥å¯¹åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä½†ç°åœ¨æˆ‘ä»¬å¸Œæœ›å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€ä¸ª**åŠ¨ä½œ**ï¼ˆactionï¼‰ã€‚æ™®é€šçš„ `map` æ— æ³•ç›´æ¥æ‰§è¡ŒåŠ¨ä½œâ€”â€”å®ƒåªèƒ½æ„é€ å‡ºåŠ¨ä½œçš„åˆ—è¡¨è€Œå·²ã€‚å¹¸è¿çš„æ˜¯ï¼ŒHaskell æä¾›äº†ä¸¤ä¸ªåœ¨åŠ¨ä½œä¸Šä¸‹æ–‡ä¸­ä¸ `map` ç­‰ä»·çš„å‡½æ•°ï¼š`mapM` ä¸ `mapM_`ã€‚å®ƒä»¬éƒ½æ¥å—ä¸€ä¸ªäº§ç”ŸåŠ¨ä½œçš„ä¸€å…ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºæ‰§è¡Œè¿™äº›åŠ¨ä½œçš„æ€»åŠ¨ä½œã€‚ä¼ å…¥çš„å‡½æ•°ä¼šå¯¹æ¯ä¸ªå…ƒç´ æ±‚å€¼ï¼Œè€Œä¸”è¿™äº›åŠ¨ä½œä¼šæŒ‰é¡ºåºæ‰§è¡Œã€‚æŠŠ `putStrLn` ä¸å­—ç¬¦ä¸²åˆ—è¡¨ç»“åˆä½¿ç”¨æ­£æ˜¯å®ƒä»¬çš„å…¸å‹åœºæ™¯ã€‚é‚£ä¹ˆåº”è¯¥é€‰å“ªä¸ªï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ç¤ºä¾‹ï¼š

```haskell
ghci> mapM putStrLn ["Hello", "World", "!"]
Hello
World
!
[(),(),()]

ghci> mapM_ putStrLn ["Hello", "World", "!"]
Hello
World
!
```

è¿™æœ‰ç‚¹å¥‡æ€ªï¼š`mapM` æ‰“å°äº†å­—ç¬¦ä¸²åè¿”å› `[(),(),()]`ï¼ˆä¸€ä¸ªå•ä½å€¼åˆ—è¡¨ï¼‰ï¼Œè€Œ `mapM_` çœ‹èµ·æ¥ä¼¼ä¹ä»€ä¹ˆä¹Ÿä¸è¿”å›ï¼ˆå®é™…ä¸Šå®ƒè¿”å› `()`ï¼Œåªæ˜¯ GHCi éšè—äº†æ˜¾ç¤ºï¼‰ã€‚ä¸¤è€…çš„å·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ`mapM` çš„è¡Œä¸ºå°±åƒ `map`ï¼šåŠ¨ä½œè¿”å›çš„å€¼ä¼šæ›¿æ¢åŸåˆ—è¡¨ä¸­çš„è¾“å…¥å€¼ï¼Œå› æ­¤ç»“æœæ˜¯è¿™äº›åŠ¨ä½œè¿”å›å€¼çš„åˆ—è¡¨ã€‚`putStrLn` è¿”å›çš„æ˜¯å•ä½å€¼ `()`ï¼Œæ‰€ä»¥ `mapM` ä¼šæ”¶é›†è®¸å¤š `()` åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­è¿”å›ã€‚`mapM_` åˆ™æ˜¯ `mapM` çš„ä¸€ä¸ªå˜ä½“ï¼Œç”¨äºé‚£äº›æˆ‘ä»¬**ä¸å…³å¿ƒåŠ¨ä½œè¿”å›å€¼**çš„æƒ…å†µã€‚å› ä¸ºå•ä½å€¼ `()` ä¸åŒ…å«ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸¢å¼ƒå®ƒâ€”â€”è¿™æ­£æ˜¯ `mapM_` æ‰€åšçš„ï¼šå¿½ç•¥æ¯ä¸ªåŠ¨ä½œçš„è¾“å‡ºï¼Œåªè¿”å›å•ä¸ª `()`ã€‚

> ç»ƒä¹ ï¼šå®ç°å•å­ç‰ˆæœ¬çš„ `map`
>  ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸¤ä¸ª `map` å‡½æ•°çš„ç±»å‹å‡è®¾ä¸ºï¼š

```haskell
mapM  :: (a -> IO b) -> [a] -> IO [b]
mapM_ :: (a -> IO b) -> [a] -> IO ()
```

å°è¯•è‡ªå·±å®ç°å®ƒä»¬ï¼å…ˆä»”ç»†åˆ†æçº¯ `map` æ˜¯å¦‚ä½•æ„æˆçš„ï¼Œç„¶åæŸ¥çœ‹æœ¬ç« å¼€å¤´çš„ `interactiveLines` ç¤ºä¾‹ã€‚ä½ å¯ä»¥ç”¨ç›¸åŒæ€è·¯å®ç° `mapM` ä¸ `mapM_`ã€‚

ç”±äºæˆ‘ä»¬è¿™é‡Œåªå…³å¿ƒæŠŠå­—ç¬¦ä¸²åˆ—è¡¨æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥ `mapM_` æ­£å¥½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ç”¨å®ƒæ‰“å°ç¼–å·è¡Œéå¸¸ç®€å•ç›´æ¥ã€‚

## 4.4 ä»åº“åˆ°å¯æ‰§è¡Œç¨‹åºï¼ˆFrom library to executableï¼‰

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰ä¸œè¥¿æ•´åˆèµ·æ¥äº†ï¼æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸Šä¸€ç« çš„ä»£ç ï¼Œè®©å®ƒèƒ½å¤Ÿè¯»å–ç”¨æˆ·æŒ‡å®šæ–‡ä»¶ä¸­çš„è¡Œï¼Œå¯¹è¿™äº›è¡Œè¿›è¡Œç¼–å·ï¼Œç”Ÿæˆç¾è§‚çš„ç¼–å·ç‰ˆæœ¬ï¼Œç„¶åæ‰“å°åˆ°å±å¹•ä¸Šï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºã€‚

**ä»£ç æ¸…å• 4.11 æä¾›è¡Œç¼–å·å·¥å…·åŸºæœ¬åŠŸèƒ½çš„ä¸»ç¨‹åº**

```haskell
main :: IO ()
main = do
  cliArgs <- getArgs         -- #1
  let mFilePath = parseArguments cliArgs     -- #2
  maybe
    (printHelpText "Missing filename")      -- #3
    ( \filePath -> do
        fileLines <- readLines filePath             -- #4
        let numbered = numberAllLines fileLines     -- #5
            prettyNumbered = prettyNumberedLines
                             PadLeft numbered        -- #6
        mapM_ putStrLn prettyNumbered               -- #7
    )
    mFilePath
```

**è¯´æ˜ï¼š**
 1ï¸âƒ£ è¯»å–ç¨‹åºå¯åŠ¨æ—¶ä¼ å…¥çš„å‘½ä»¤è¡Œå‚æ•°
 2ï¸âƒ£ è§£ææ–‡ä»¶åå‚æ•°
 3ï¸âƒ£ å¦‚æœå‚æ•°æ•°é‡ä¸æ­£ç¡®ï¼Œåˆ™è¾“å‡ºå¸®åŠ©æ–‡æœ¬
 4ï¸âƒ£ ä»æ–‡ä»¶ä¸­è¯»å–æ‰€æœ‰è¡Œ
 5ï¸âƒ£ å¯¹æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œè¿›è¡Œç¼–å·
 6ï¸âƒ£ ç”Ÿæˆå¸¦æœ‰è¡Œå·çš„æ˜“è¯»å­—ç¬¦ä¸²è¡¨ç¤º
 7ï¸âƒ£ å°†ç»“æœæ‰“å°åˆ°å±å¹•ä¸Š

æŠŠæ‰€æœ‰æ¨¡å—ç»„åˆèµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥æµ‹è¯•ç¨‹åºäº†ï¼è®©æˆ‘ä»¬è¯•ç€å¯¹ä¸€äº›è¡Œè¿›è¡Œç¼–å·ï¼š

```bash
shell $ stack run -- testFile.txt
 1 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas a
 2 mattis nisi, eleifend auctor erat. Vivamus nisl sapien, suscipit non
 3 gravida sed, mattis a velit. Fusce non iaculis urna, a volutpat leo.
 4 Ut non mauris vel massa tincidunt mattis. Sed eu viverra lectus.
 5 Donec pulvinar justo quis condimentum suscipit. Donec vel odio eu
 6 odio maximus consequat at at tellus. Ut placerat suscipit vulputate.
 7 Donec eu eleifend massa, et aliquet ipsum.
 8
 9 Mauris eget massa a tellus tristique consequat. Nunc tempus sit amet
10 est sit amet malesuada. Curabitur ultrices in leo vitae tristique.
11 Suspendisse potenti. Nam dui risus, gravida eu scelerisque sit amet,
12 tincidunt id neque. In sit amet purus gravida, venenatis lectus sit
13 amet, gravida massa. In iaculis commodo massa, in viverra est mollis
14 et. Nunc vehicula felis a vestibulum egestas. Phasellus eu libero sed
15 odio facilisis feugiat id quis velit. Proin a ex dapibus, lacinia dui
16 at, vehicula ipsum.
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ° `PadLeft` è®©è¡Œå·å³å¯¹é½äº†ã€‚
 è¿™ä¸ªå·¥å…·çš„åŠŸèƒ½ä¸æˆ‘ä»¬çš„é¢„æœŸå¤§è‡´ä¸€è‡´ã€‚
 æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¸…å•ä¸Šçš„æœ€åä¸€é¡¹ä»»åŠ¡æ˜¯â€”â€”**æ·»åŠ æ›´å¤šé€‰é¡¹**ã€‚

------

### 4.4.1 å‘½ä»¤è¡Œé€‰é¡¹ç¼–ç ä¸è§£æï¼ˆEncoding and parsing command line optionsï¼‰

æœ€åï¼Œæˆ‘ä»¬å¸Œæœ›ä¸ºç¨‹åºæ·»åŠ æ›´å¤šé€‰é¡¹ã€‚å¯¹äºè¿™ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¸Œæœ›æ”¯æŒä»¥ä¸‹ä¸‰ä¸ªå‚æ•°ï¼š

- `--reverse`ï¼šåè½¬è¡Œå·é¡ºåº
- `--skip-empty`ï¼šè·³è¿‡ç©ºè¡Œç¼–å·
- `--left-align`ï¼šè¡Œå·å·¦å¯¹é½

ä¸ºäº†åœ¨ç¨‹åºä¸­è¡¨ç¤ºè¿™äº›é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**ä»£æ•°æ•°æ®ç±»å‹ï¼ˆAlgebraic Data Typeï¼‰**ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼ˆä»£ç æ¸…å• 4.12ï¼‰ã€‚è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªæ–°å…³é”®å­— `deriving`ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« è¯¦ç»†ä»‹ç»ã€‚ç›®å‰ä½ åªéœ€è¦çŸ¥é“ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä¸ºè¿™ä¸ªæ•°æ®ç±»å‹æ´¾ç”Ÿï¼ˆderiveï¼‰`Eq` ç±»å‹ç±»ï¼Œä»¥ä¾¿æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚

**ä»£ç æ¸…å• 4.12 è¡¨ç¤ºè¡Œå·ç¨‹åºé€‰é¡¹çš„æ•°æ®ç±»å‹**

```haskell
data LineNumberOption
  = ReverseNumbering     -- #1
  | SkipEmptyLines        -- #2
  | LeftAlign              -- #3
  deriving (Eq)            -- #4
```

**è¯´æ˜ï¼š**
 1ï¸âƒ£ è¡¨ç¤º `--reverse`
 2ï¸âƒ£ è¡¨ç¤º `--skip-empty`
 3ï¸âƒ£ è¡¨ç¤º `--left-align`
 4ï¸âƒ£ ä¸ºæ­¤ç±»å‹æ´¾ç”Ÿ `Eq` ç±»å‹ç±»

------

åŸºäºè¿™ä¸ªæ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥å°†å­—ç¬¦ä¸²è§£æä¸ºç›¸åº”çš„æ„é€ å™¨ã€‚è¿™é‡Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨ `Maybe`ï¼Œä»¥è¡¨ç¤ºè§£æå¯èƒ½ä¼šå¤±è´¥ã€‚

**ä»£ç æ¸…å• 4.13 å°†å­—ç¬¦ä¸²è§£æä¸ºé€‰é¡¹ç±»å‹çš„å‡½æ•°**

```haskell
lnOptionFromString :: String -> Maybe LineNumberOption
lnOptionFromString "--reverse"    = Just ReverseNumbering    -- #1
lnOptionFromString "--skip-empty" = Just SkipEmptyLines      -- #1
lnOptionFromString "--left-align" = Just LeftAlign           -- #1
lnOptionFromString _ = Nothing                              -- #2
```

**è¯´æ˜ï¼š**
 1ï¸âƒ£ å°†åŒ¹é…çš„å­—ç¬¦ä¸²è§£æä¸ºå¯¹åº”æ„é€ å™¨
 2ï¸âƒ£ æ— æ³•è§£æçš„å­—ç¬¦ä¸²è¿”å› `Nothing`

å‡è®¾å‘½ä»¤è¡Œå‚æ•°çš„é¡ºåºæ˜¯å›ºå®šçš„ï¼š**é€‰é¡¹åœ¨å‰ï¼Œæ–‡ä»¶ååœ¨å**ã€‚è¿™ä¼šè®©è§£æå˜å¾—ç®€å•ä¸€äº›ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `reverse` å‡½æ•°å…ˆåè½¬å‚æ•°åˆ—è¡¨ã€‚è¿™æ ·ï¼Œæ–‡ä»¶åï¼ˆåŸæœ¬æœ€åä¸€ä¸ªï¼‰å°±æˆäº†åè½¬ååˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿™è®©æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨ `x:xs` æ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚è§£æå‰©ä½™çš„å‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Data.Maybe` æ¨¡å—ä¸­çš„ `mapMaybe`ï¼ˆç±»å‹ä¸º `(a -> Maybe b) -> [a] -> [b]`ï¼‰æ¥è°ƒç”¨ `lnOptionFromString`ã€‚`mapMaybe` ä¼šè‡ªåŠ¨å¿½ç•¥æ‰€æœ‰ `Nothing` å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•è§£æçš„å‚æ•°ä¼šè¢«è·³è¿‡ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ª `Maybe FilePath` å’Œä¸€ä¸ªé€‰é¡¹åˆ—è¡¨ `[LineNumberOption]`ï¼š

**ä»£ç æ¸…å• 4.14 è§£æå‘½ä»¤è¡Œå‚æ•°çš„å‡½æ•°**

```haskell
import Data.Maybe
...
parseArguments :: [String] -> (Maybe FilePath, [LineNumberOption])
parseArguments args = case reverse args of                     -- #1
  [] -> (Nothing, [])                                           -- #2
  (filename : options) ->
    ( Just filename,                                            -- #3
      mapMaybe lnOptionFromString options                       -- #4
    )
```

**è¯´æ˜ï¼š**
 1ï¸âƒ£ å¯¹åè½¬åçš„å‚æ•°åˆ—è¡¨è¿›è¡Œæ¨¡å¼åŒ¹é…
 2ï¸âƒ£ å‚æ•°ä¸ºç©ºæ—¶è¿”å›ç©ºç»“æœ
 3ï¸âƒ£ å¦‚æœå­˜åœ¨æ–‡ä»¶ååˆ™è¿”å› `Just filename`
 4ï¸âƒ£ è§£æé€‰é¡¹å‚æ•°ï¼Œå¿½ç•¥æ— æ•ˆé¡¹

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ•´åˆè¿›æ¸…å• 4.11 çš„ `main` å‡½æ•°ä¸­ã€‚åœ¨ä¿®æ”¹ç¨‹åºæ§åˆ¶æµä¹‹å‰ï¼Œå…ˆåœä¸‹æ¥æ€è€ƒä¸€ä¸‹ï¼šç¨‹åºçš„æ§åˆ¶æµä¸»è¦ç”±æ‰€ä½¿ç”¨çš„å‡½æ•°å†³å®šã€‚å½“æˆ‘ä»¬å¸Œæœ›æ ¹æ®æŸäº›å˜é‡ï¼ˆå¦‚é€‰é¡¹ï¼‰æ¥æ”¹å˜æ§åˆ¶æµæ—¶ï¼Œåœ¨ Haskell ä¸­ï¼Œä¸€ä¸ªæ›´ä¼˜é›…çš„åšæ³•æ˜¯â€”â€”**ç›´æ¥åˆ‡æ¢å‡½æ•°**ã€‚Haskell ä¸­çš„å‡½æ•°æ˜¯å€¼ï¼Œå¯ä»¥åƒå…¶ä»–å€¼ä¸€æ ·è¢«ä¼ é€’ã€èµ‹å€¼ã€‚æ‰€ä»¥ï¼Œä¸å…¶æŠŠé€‰é¡¹ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä¸å¦‚æ ¹æ®é€‰é¡¹åŠ¨æ€é€‰æ‹©ä¸åŒçš„å‡½æ•°ã€‚

ä¾‹å¦‚ï¼š

```haskell
let numberFunction =
      if SkipEmptyLines `elem` options      -- #1
        then numberNonEmptyLines            -- #2
        else numberAllLines                 -- #2
```

**è¯´æ˜ï¼š**
 1ï¸âƒ£ æ£€æŸ¥ `SkipEmptyLines` æ˜¯å¦å­˜åœ¨äºé€‰é¡¹åˆ—è¡¨ä¸­
 2ï¸âƒ£ æ ¹æ®ç»“æœé€‰æ‹©åˆé€‚çš„å‡½æ•°

è¿™é‡Œæˆ‘ä»¬å‡è®¾ `options` çš„ç±»å‹ä¸º `[LineNumberOption]`ï¼Œå®ƒæ¥è‡ªäºä¸Šé¢ `parseArguments` çš„ç»“æœã€‚æˆ‘ä»¬å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡ `numberFunction`ï¼Œå®è´¨ä¸Šæ˜¯**æ ¹æ®å¸ƒå°”è¡¨è¾¾å¼çš„ç»“æœæ”¹å˜å‡½æ•°å®šä¹‰**ã€‚è¿™è®©æˆ‘ä»¬èƒ½å¤Ÿå°†é€‰é¡¹é€»è¾‘ä¼˜é›…åœ°èå…¥ä¸»æµç¨‹ä¸­ã€‚ç¤ºä¾‹æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š

```bash
shell $ stack run -- --skip-empty --left-align --reverse testFile.txt
16 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas a
15 mattis nisi, eleifend auctor erat. Vivamus nisl sapien, suscipit non
14 gravida sed, mattis a velit. Fusce non iaculis urna, a volutpat leo.
13 Ut non mauris vel massa tincidunt mattis. Sed eu viverra lectus.
12 Donec pulvinar justo quis condimentum suscipit. Donec vel odio eu
11 odio maximus consequat at at tellus. Ut placerat suscipit vulputate.
10 Donec eu eleifend massa, et aliquet ipsum.
8  Mauris eget massa a tellus tristique consequat. Nunc tempus sit amet
7  est sit amet malesuada. Curabitur ultrices in leo vitae tristique.
6  Suspendisse potenti. Nam dui risus, gravida eu scelerisque sit amet,
5  tincidunt id neque. In sit amet purus gravida, venenatis lectus sit
4  amet, gravida massa. In iaculis commodo massa, in viverra est mollis
3  et. Nunc vehicula felis a vestibulum egestas. Phasellus eu libero sed
2  odio facilisis feugiat id quis velit. Proin a ex dapibus, lacinia dui
1  at, vehicula ipsum.
```

