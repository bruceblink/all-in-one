---
sidebar_position: 5
typora-root-url: ./..\..\static
---
# ç¬¬ 4 ç«  - è¡Œå·å·¥å…·ï¼ˆLine numbering toolï¼‰
æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š

* ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶
* é€šè¿‡å‡½æ•°å‚æ•°å¯¹é«˜é˜¶å‡½æ•°çš„è¡Œä¸ºè¿›è¡Œå‚æ•°åŒ–
* ä½¿ç”¨ä»£æ•°æ•°æ®ç»“æ„æ¥ç¼–ç å¯é€‰é¡¹
* å°†ä»£ç æ‰“åŒ…ä¸ºå¯æ‰§è¡Œç¨‹åº

åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ºä¸€ä¸ªå¯ä»¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œè¡Œå·ç¼–å·çš„å·¥å…·æ‰“ä¸‹äº†åŸºç¡€ã€‚æˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚ä½•ä»ç”¨æˆ·é‚£é‡Œè¯»å–å‚æ•°ã€‚å› æ­¤ï¼Œç°åœ¨å¯ä»¥å¼€å§‹è€ƒè™‘å¦‚ä½•ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œä»¥åŠå¦‚ä½•è·å–æ–‡ä»¶å†…å®¹ä¸­çš„å„ä¸ªè¡Œã€‚

æœ¬ç« å°†ä»â€œè¯»å–æ–‡ä»¶å¹¶è½¬æ¢å†…å®¹â€å¼€å§‹ï¼Œç„¶åç¼–å†™ä¸€ä¸ªé€šç”¨å‡½æ•°ï¼Œå…¶æ§åˆ¶æµä¸æ•°æ®æµç”±ä½œä¸ºå‚æ•°ä¼ å…¥çš„å‡½æ•°å†³å®šã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ä»£æ•°æ•°æ®ç»“æ„æ¥è¡¨è¾¾ç¨‹åºé€‰é¡¹ï¼Œå¹¶æœ€ç»ˆå®Œæˆä¸Šä¸€ç« ä¸­çš„å·¥å…·ã€‚

## 4.1 æ–‡ä»¶è¯»å–ä¸å†…å®¹è½¬æ¢ï¼ˆReading files and transforming their contentï¼‰

ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰§è¡Œ IO æ“ä½œçš„åŠ¨ä½œã€‚Haskell æä¾›äº†ä¸¤ä¸ªæœ€åŸºæœ¬çš„æ–‡ä»¶æ“ä½œå‡½æ•°ï¼š

```haskell
readFile :: FilePath -> IO String
writeFile :: FilePath -> String -> IO ()
```

é¡¾åæ€ä¹‰ï¼Œ`readFile` ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼Œå¹¶å°†æ•´ä¸ªæ–‡ä»¶å†…å®¹ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ï¼›è€Œ `writeFile` æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶å°†å…¶å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚

è¿™é‡Œæˆ‘ä»¬åˆä¸€æ¬¡çœ‹åˆ°ä½¿ç”¨ç±»å‹åŒä¹‰è¯ï¼ˆå¦‚ `FilePath`ï¼‰çš„æ„ä¹‰ã€‚ä»…ä»ç±»å‹åå°±èƒ½æ˜ç¡®çŸ¥é“å‚æ•°çš„å«ä¹‰ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ `String` ç±»å‹ï¼Œè¿™ä¸€ç‚¹å°±ä¸å¤ªæ˜æ˜¾ã€‚ä»…é€šè¿‡ç±»å‹å£°æ˜ï¼Œæˆ‘ä»¬å°±èƒ½æ¨æ–­å‡ºè¿™äº›å‡½æ•°çš„å¤§è‡´ç”¨é€”ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä½¿ç”¨ `readFile` æ¥æ„å»ºä¸€ä¸ªèƒ½è¿”å›æ–‡ä»¶è¡Œåˆ—è¡¨çš„åŠ¨ä½œã€‚ä¸ºæ­¤ï¼Œéœ€è¦å°†æ–‡ä»¶å†…å®¹æŒ‰æ¢è¡Œç¬¦ `\n` è¿›è¡Œåˆ†å‰²ã€‚å¹¸è¿çš„æ˜¯ï¼ŒHaskell ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç°æˆçš„å‡½æ•° `lines`ï¼Œå®ƒæ­£å¥½å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š

```haskell
ghci> :t lines
lines :: String -> [String]
ghci> lines "Hello\nWorld\n"
["Hello","World"]
```

å¦‚ä½ æ‰€è§ï¼Œ`lines` ä¼šæŠŠå­—ç¬¦ä¸²æŒ‰è¡Œåˆ†å‰²ï¼Œå¹¶è‡ªåŠ¨å»æ‰æ¢è¡Œç¬¦ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªåå‡½æ•° `unlines`ï¼Œå‡ ä¹æ‰§è¡Œç›¸åçš„æ“ä½œï¼š

```haskell
ghci> :t unlines
unlines :: [String] -> String
ghci> unlines ["Hello", "World"]
"Hello\nWorld\n"
ghci> unlines (lines "Hello\nWorld")
"Hello\nWorld\n"
```

`unlines` ä¼šåœ¨æ¯ä¸ªå­—ç¬¦ä¸²åéƒ½åŠ ä¸Šä¸€ä¸ªæ¢è¡Œç¬¦ï¼›è€Œ `lines` åˆ™ä¼šå¿½ç•¥è¾“å…¥å­—ç¬¦ä¸²æœ«å°¾æ˜¯å¦ç¼ºå°‘æ¢è¡Œç¬¦ã€‚

é™¤äº†è¿™ä¸¤ä¸ªå‡½æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰ `words` ä¸ `unwords`ï¼Œå®ƒä»¬å¯ä»¥æŒ‰ç©ºæ ¼åˆ†å‰²ï¼ˆæˆ–é‡æ–°æ‹¼æ¥ï¼‰å­—ç¬¦ä¸²ã€‚æ‰€æœ‰è¿™äº›å‡½æ•°éƒ½åœ¨ `Data.String` æ¨¡å—ä¸­å®šä¹‰ï¼›ä½†æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼å¯¼å…¥ï¼Œå› ä¸ºå®ƒä»¬å·²é€šè¿‡ `Prelude` å¯¼å‡ºï¼Œè€Œ `Prelude` æ˜¯æ¯ä¸ª Haskell ç¨‹åºé»˜è®¤å¯¼å…¥çš„æ¨¡å—ã€‚

> ğŸ’¡ æ³¨æ„ï¼š`Prelude` ä¼šé‡æ–°å¯¼å‡ºæ¥è‡ªä¸åŒæ¨¡å—çš„é‡è¦å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œ`readFile` å’Œ `writeFile` å®é™…ä¸Šæœ€åˆå®šä¹‰äº `System.IO` æ¨¡å—ã€‚ç”±äº `Prelude` é»˜è®¤å¯¼å…¥ï¼Œæˆ‘ä»¬ä¸å¿…æ˜¾å¼å¼•å…¥ `System.IO`ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¯‘å™¨æ ‡å¿—æˆ– pragma ç¦ç”¨ `Prelude` çš„è‡ªåŠ¨å¯¼å…¥ï¼Œä½†é€šå¸¸æ²¡æœ‰å¿…è¦ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªåŠ¨ä½œï¼Œä½¿ç”¨ `readFile` å’Œ `lines` æ¥è¯»å–æ–‡ä»¶çš„æ¯ä¸€è¡Œã€‚æˆ‘ä»¬å…ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼Œç„¶åå°†å…¶ä¼ ç»™ `lines` å‡½æ•°å¹¶è¿”å›ç»“æœã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

```haskell
-- ä»£ç æ¸…å• 4.1ï¼šè¯»å–æ–‡ä»¶è¡Œçš„åŠ¨ä½œ
readLines :: FilePath -> IO [String]
readLines filePath = do
  contents <- readFile filePath      -- #1 è¯»å–æŒ‡å®šè·¯å¾„ä¸‹çš„æ•´ä¸ªæ–‡ä»¶å†…å®¹
  return (lines contents)            -- #2 å°†æ–‡ä»¶å†…å®¹æŒ‰æ¢è¡Œç¬¦åˆ†å‰²ä¸ºè¡Œåˆ—è¡¨
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ­¤æ“ä½œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è¿™å¯¹æˆ‘ä»¬æ¥è¯´æ²¡é—®é¢˜ï¼Œå› ä¸ºé”™è¯¯ä¿¡æ¯è¶³ä»¥æç¤ºç”¨æˆ·å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–å¤„ç†è¿™ç§é”™è¯¯ã€‚

åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `testFile.txt` çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```
Hello
dear
reader!
```

ç„¶åå¯åŠ¨ REPLï¼ˆä½¿ç”¨ `stack repl`ï¼‰ï¼Œæ‰§è¡Œæˆ‘ä»¬çš„åŠ¨ä½œï¼š

```haskell
ghci> readLines "testFile.txt"
["Hello","dear","reader!"]
```

å¾ˆå¥½ï¼ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä¸ºè¿™äº›è¡Œæ·»åŠ è¡Œå·äº†ï¼

