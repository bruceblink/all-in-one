---
sidebar_position: 5
typora-root-url: ./..\..\static
---
# ç¬¬ 4 ç«  - è¡Œå·å·¥å…·ï¼ˆLine numbering toolï¼‰
æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š

* ä»Žæ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶
* é€šè¿‡å‡½æ•°å‚æ•°å¯¹é«˜é˜¶å‡½æ•°çš„è¡Œä¸ºè¿›è¡Œå‚æ•°åŒ–
* ä½¿ç”¨ä»£æ•°æ•°æ®ç»“æž„æ¥ç¼–ç å¯é€‰é¡¹
* å°†ä»£ç æ‰“åŒ…ä¸ºå¯æ‰§è¡Œç¨‹åº

åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ºä¸€ä¸ªå¯ä»¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œè¡Œå·ç¼–å·çš„å·¥å…·æ‰“ä¸‹äº†åŸºç¡€ã€‚æˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚ä½•ä»Žç”¨æˆ·é‚£é‡Œè¯»å–å‚æ•°ã€‚å› æ­¤ï¼ŒçŽ°åœ¨å¯ä»¥å¼€å§‹è€ƒè™‘å¦‚ä½•ä»Žæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œä»¥åŠå¦‚ä½•èŽ·å–æ–‡ä»¶å†…å®¹ä¸­çš„å„ä¸ªè¡Œã€‚

æœ¬ç« å°†ä»Žâ€œè¯»å–æ–‡ä»¶å¹¶è½¬æ¢å†…å®¹â€å¼€å§‹ï¼Œç„¶åŽç¼–å†™ä¸€ä¸ªé€šç”¨å‡½æ•°ï¼Œå…¶æŽ§åˆ¶æµä¸Žæ•°æ®æµç”±ä½œä¸ºå‚æ•°ä¼ å…¥çš„å‡½æ•°å†³å®šã€‚æŽ¥ç€ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ä»£æ•°æ•°æ®ç»“æž„æ¥è¡¨è¾¾ç¨‹åºé€‰é¡¹ï¼Œå¹¶æœ€ç»ˆå®Œæˆä¸Šä¸€ç« ä¸­çš„å·¥å…·ã€‚

## 4.1 æ–‡ä»¶è¯»å–ä¸Žå†…å®¹è½¬æ¢ï¼ˆReading files and transforming their contentï¼‰

ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰§è¡Œ IO æ“ä½œçš„åŠ¨ä½œã€‚Haskell æä¾›äº†ä¸¤ä¸ªæœ€åŸºæœ¬çš„æ–‡ä»¶æ“ä½œå‡½æ•°ï¼š

```haskell
readFile :: FilePath -> IO String
writeFile :: FilePath -> String -> IO ()
```

é¡¾åæ€ä¹‰ï¼Œ`readFile` ä»Žæ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼Œå¹¶å°†æ•´ä¸ªæ–‡ä»¶å†…å®¹ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›žï¼›è€Œ `writeFile` æŽ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶å°†å…¶å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œå¦‚æžœæ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚

è¿™é‡Œæˆ‘ä»¬åˆä¸€æ¬¡çœ‹åˆ°ä½¿ç”¨ç±»åž‹åŒä¹‰è¯ï¼ˆå¦‚ `FilePath`ï¼‰çš„æ„ä¹‰ã€‚ä»…ä»Žç±»åž‹åå°±èƒ½æ˜Žç¡®çŸ¥é“å‚æ•°çš„å«ä¹‰ã€‚å¦‚æžœç›´æŽ¥ä½¿ç”¨ `String` ç±»åž‹ï¼Œè¿™ä¸€ç‚¹å°±ä¸å¤ªæ˜Žæ˜¾ã€‚ä»…é€šè¿‡ç±»åž‹å£°æ˜Žï¼Œæˆ‘ä»¬å°±èƒ½æŽ¨æ–­å‡ºè¿™äº›å‡½æ•°çš„å¤§è‡´ç”¨é€”ã€‚

æŽ¥ä¸‹æ¥æˆ‘ä»¬è¦ä½¿ç”¨ `readFile` æ¥æž„å»ºä¸€ä¸ªèƒ½è¿”å›žæ–‡ä»¶è¡Œåˆ—è¡¨çš„åŠ¨ä½œã€‚ä¸ºæ­¤ï¼Œéœ€è¦å°†æ–‡ä»¶å†…å®¹æŒ‰æ¢è¡Œç¬¦ `\n` è¿›è¡Œåˆ†å‰²ã€‚å¹¸è¿çš„æ˜¯ï¼ŒHaskell ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªçŽ°æˆçš„å‡½æ•° `lines`ï¼Œå®ƒæ­£å¥½å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š

```haskell
ghci> :t lines
lines :: String -> [String]
ghci> lines "Hello\nWorld\n"
["Hello","World"]
```

å¦‚ä½ æ‰€è§ï¼Œ`lines` ä¼šæŠŠå­—ç¬¦ä¸²æŒ‰è¡Œåˆ†å‰²ï¼Œå¹¶è‡ªåŠ¨åŽ»æŽ‰æ¢è¡Œç¬¦ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªåå‡½æ•° `unlines`ï¼Œå‡ ä¹Žæ‰§è¡Œç›¸åçš„æ“ä½œï¼š

```haskell
ghci> :t unlines
unlines :: [String] -> String
ghci> unlines ["Hello", "World"]
"Hello\nWorld\n"
ghci> unlines (lines "Hello\nWorld")
"Hello\nWorld\n"
```

`unlines` ä¼šåœ¨æ¯ä¸ªå­—ç¬¦ä¸²åŽéƒ½åŠ ä¸Šä¸€ä¸ªæ¢è¡Œç¬¦ï¼›è€Œ `lines` åˆ™ä¼šå¿½ç•¥è¾“å…¥å­—ç¬¦ä¸²æœ«å°¾æ˜¯å¦ç¼ºå°‘æ¢è¡Œç¬¦ã€‚

é™¤äº†è¿™ä¸¤ä¸ªå‡½æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰ `words` ä¸Ž `unwords`ï¼Œå®ƒä»¬å¯ä»¥æŒ‰ç©ºæ ¼åˆ†å‰²ï¼ˆæˆ–é‡æ–°æ‹¼æŽ¥ï¼‰å­—ç¬¦ä¸²ã€‚æ‰€æœ‰è¿™äº›å‡½æ•°éƒ½åœ¨ `Data.String` æ¨¡å—ä¸­å®šä¹‰ï¼›ä½†æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼å¯¼å…¥ï¼Œå› ä¸ºå®ƒä»¬å·²é€šè¿‡ `Prelude` å¯¼å‡ºï¼Œè€Œ `Prelude` æ˜¯æ¯ä¸ª Haskell ç¨‹åºé»˜è®¤å¯¼å…¥çš„æ¨¡å—ã€‚

> ðŸ’¡ æ³¨æ„ï¼š`Prelude` ä¼šé‡æ–°å¯¼å‡ºæ¥è‡ªä¸åŒæ¨¡å—çš„é‡è¦å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œ`readFile` å’Œ `writeFile` å®žé™…ä¸Šæœ€åˆå®šä¹‰äºŽ `System.IO` æ¨¡å—ã€‚ç”±äºŽ `Prelude` é»˜è®¤å¯¼å…¥ï¼Œæˆ‘ä»¬ä¸å¿…æ˜¾å¼å¼•å…¥ `System.IO`ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¯‘å™¨æ ‡å¿—æˆ– pragma ç¦ç”¨ `Prelude` çš„è‡ªåŠ¨å¯¼å…¥ï¼Œä½†é€šå¸¸æ²¡æœ‰å¿…è¦ã€‚

çŽ°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªåŠ¨ä½œï¼Œä½¿ç”¨ `readFile` å’Œ `lines` æ¥è¯»å–æ–‡ä»¶çš„æ¯ä¸€è¡Œã€‚æˆ‘ä»¬å…ˆè¯»å–æ–‡ä»¶å†…å®¹ï¼Œç„¶åŽå°†å…¶ä¼ ç»™ `lines` å‡½æ•°å¹¶è¿”å›žç»“æžœã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

```haskell
-- ä»£ç æ¸…å• 4.1ï¼šè¯»å–æ–‡ä»¶è¡Œçš„åŠ¨ä½œ
readLines :: FilePath -> IO [String]
readLines filePath = do
  contents <- readFile filePath      -- #1 è¯»å–æŒ‡å®šè·¯å¾„ä¸‹çš„æ•´ä¸ªæ–‡ä»¶å†…å®¹
  return (lines contents)            -- #2 å°†æ–‡ä»¶å†…å®¹æŒ‰æ¢è¡Œç¬¦åˆ†å‰²ä¸ºè¡Œåˆ—è¡¨
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ­¤æ“ä½œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è¿™å¯¹æˆ‘ä»¬æ¥è¯´æ²¡é—®é¢˜ï¼Œå› ä¸ºé”™è¯¯ä¿¡æ¯è¶³ä»¥æç¤ºç”¨æˆ·å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–å¤„ç†è¿™ç§é”™è¯¯ã€‚

åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `testFile.txt` çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```
Hello
dear
reader!
```

ç„¶åŽå¯åŠ¨ REPLï¼ˆä½¿ç”¨ `stack repl`ï¼‰ï¼Œæ‰§è¡Œæˆ‘ä»¬çš„åŠ¨ä½œï¼š

```haskell
ghci> readLines "testFile.txt"
["Hello","dear","reader!"]
```

å¾ˆå¥½ï¼çŽ°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä¸ºè¿™äº›è¡Œæ·»åŠ è¡Œå·äº†ï¼

### 4.1.1 ç¼–å†™çº¯åº“ï¼ˆWriting a pure libraryï¼‰

çŽ°åœ¨æˆ‘ä»¬å¯ä»¥æŠŠæ³¨æ„åŠ›è½¬å‘é¡¹ç›®ä¸­çš„ **Lib æ¨¡å—**ã€‚ç”±äºŽç»™è¡Œç¼–å·çš„ä»£ç æœ¬èº«ç›¸å½“é€šç”¨ï¼Œå› æ­¤ç†åº”ä¿å­˜åœ¨åº“æ¨¡å—ä¸­ã€‚åœ¨å‰é¢ï¼Œæˆ‘ä»¬å·²ç»å¤„ç†äº†ç¨‹åºä¸­çš„è®¸å¤šä¸çº¯ï¼ˆimpureï¼‰éƒ¨åˆ†ï¼ŒçŽ°åœ¨å¯ä»¥ä¸“æ³¨äºŽç¼–å†™çº¯ä»£ç ï¼ˆpure codeï¼‰äº†â€”â€”è¿™éƒ¨åˆ†é€»è¾‘åº”è¯¥æ›´å®¹æ˜“ç†è§£ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¸Œæœ›æ”¯æŒå“ªäº›åŠŸèƒ½ï¼šæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¯¹**æ¯ä¸€è¡Œ**è¿›è¡Œç¼–å·ï¼Œæˆ–ä»…å¯¹**æ»¡è¶³æŸä¸ªæ¡ä»¶**ï¼ˆè°“è¯ï¼‰çš„è¡Œç¼–å·ï¼Œä¾‹å¦‚è¡Œéžç©ºæˆ–åŒ…å«æŸä¸ªå­å­—ç¬¦ä¸²ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œèƒ½å¤Ÿä¸ºè¡Œç”Ÿæˆå¯¹åº”çš„è¡Œå·æ˜ å°„ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›æ”¯æŒ**ä¸åŒæ ¼å¼çš„è¡Œå·æ˜¾ç¤º**ï¼Œä¾‹å¦‚å·¦å¯¹é½æˆ–å³å¯¹é½ã€‚ä¸ºæ­¤ï¼Œåœ¨è¿›è¡Œæ ¼å¼åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆæ”¶é›†æ‰€æœ‰è¡Œå·ï¼Œä»¥è®¡ç®—æ‰€éœ€çš„å¡«å……é•¿åº¦ã€‚

æˆ‘ä»¬å…ˆæ€è€ƒå¦‚ä½•ç”¨æ•°æ®ç±»åž‹è¡¨ç¤ºè¿™ç§â€œä»Žè¡Œå·åˆ°è¡Œå†…å®¹â€çš„æ˜ å°„ã€‚æˆ‘ä»¬çŸ¥é“å¿…é¡»æ”¯æŒæŠŠä»»æ„æ•°é‡çš„æ•°å­—æ˜ å°„åˆ°è¡Œå†…å®¹ä¸Šã€‚åŒæ—¶ï¼Œæ˜ å°„çš„é¡ºåºä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬è¦çŸ¥é“æ‰“å°æ—¶çš„é¡ºåºã€‚åˆ—è¡¨ï¼ˆ`List`ï¼‰å‡ ä¹Žèƒ½æ»¡è¶³æ‰€æœ‰éœ€æ±‚â€”â€”å®ƒå¯ä»¥æœ‰ä»»æ„é•¿åº¦ï¼Œä¸”é¡ºåºå›ºå®šã€‚ä½†é—®é¢˜æ˜¯ï¼š**å¦‚ä½•åœ¨åˆ—è¡¨ä¸­è¡¨ç¤ºä¸€ä¸ªæ˜ å°„ï¼Ÿ**ç­”æ¡ˆå°±æ˜¯**å…³è”åˆ—è¡¨ï¼ˆassociative listï¼‰**ã€‚å…³è”åˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªé”®å€¼æ˜ å°„ã€‚è€Œæœ€ç®€å•çš„é”®å€¼ç»„åˆæ–¹å¼å°±æ˜¯**äºŒå…ƒç»„ï¼ˆtupleï¼‰**ï¼Œå®ƒå¯ä»¥æŠŠä¸¤ä¸ªä¸åŒç±»åž‹çš„å€¼æ”¾åœ¨ä¸€èµ·ã€‚

å› æ­¤ï¼Œä¸€ä¸ªå¯èƒ½çš„ç±»åž‹å®šä¹‰å¦‚ä¸‹ï¼š

```haskell
type NumberedLines = [(Int, String)]
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½ç”¨å®ƒæ¥è¡¨ç¤ºè¡Œå·ä¸Žè¡Œå†…å®¹çš„å¯¹åº”å…³ç³»ã€‚

> ðŸ’¡ æ³¨æ„
>  å…³è”åˆ—è¡¨éžå¸¸çµæ´»ï¼Œå¯ä»¥ç”¨æ¥æž„å»ºå¤šç§æ˜ å°„ç»“æž„ã€‚
>  ä¸è¿‡ï¼Œå®ƒä»¬çš„ç®—æ³•åœ¨è¿è¡Œæ—¶å¤æ‚åº¦ä¸Šé€šå¸¸æ¯”è¾ƒé«˜ï¼Œå› ä¸ºå¤§å¤šæ•°æƒ…å†µä¸‹æŸ¥æ‰¾é”®éƒ½éœ€è¦éåŽ†æ•´ä¸ªåˆ—è¡¨ã€‚
>  ä½†å¦‚æžœæ€§èƒ½ä¸æ˜¯ä¸»è¦å…³æ³¨ç‚¹ï¼Œå…³è”åˆ—è¡¨ä¾ç„¶æ˜¯ä¸€ç§éžå¸¸æ–¹ä¾¿çš„æ•°æ®ç»“æž„ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```haskell
[(1, "First Line"), (2, "Second Line"), (3, "Third Line")]
```

ä¸è¿‡ï¼Œè¿™ç§è¡¨ç¤ºæ–¹å¼å¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚å› ä¸ºæˆ‘ä»¬å¸Œæœ›èƒ½é€‰æ‹©æ€§åœ°ç»™æŸäº›è¡Œç¼–å·â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº›è¡Œå¯èƒ½**æ²¡æœ‰è¡Œå·**ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§èƒ½è¡¨è¾¾â€œæŸè¡Œå¯èƒ½æ²¡æœ‰ç¼–å·â€çš„ç±»åž‹ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»è§è¿‡å¯ä»¥è¡¨ç¤ºâ€œç¼ºå¤±å€¼â€çš„ç±»åž‹ï¼š`Maybe`ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ï¼š

```haskell
type NumberedLine = (Maybe Int, String)
type NumberedLines = [NumberedLine]
```

è¿™æ ·ï¼Œä¸€ä¸ªè¡Œå…ƒç´ åŒ…å«ä¸€ä¸ª**å¯é€‰çš„è¡Œå·**å’Œè¡Œå†…å®¹çš„å­—ç¬¦ä¸²ã€‚è€Œæ‰€æœ‰çš„ç¼–å·è¡Œå°±æ˜¯è¿™äº›æ˜ å°„ç»„æˆçš„åˆ—è¡¨ã€‚

> ðŸ’¡ æ³¨æ„
>  åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œ`Maybe` ä¸ä»…èƒ½ç”¨äºŽæ•èŽ·é”™è¯¯ï¼Œä¹Ÿèƒ½ç”¨äºŽè¡¨è¾¾â€œå¯é€‰å€¼â€ã€‚
>  è®¸å¤šå…¶ä»–è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼ Haskell `Maybe` çš„ç±»åž‹ï¼Œé€šå¸¸è¢«ç§°ä¸º `Option` æˆ–ç±»ä¼¼çš„åå­—ã€‚

------

æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†è¡¨ç¤ºè¡Œå·çš„ç±»åž‹ï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘éœ€è¦æž„é€ å“ªäº›å‡½æ•°äº†ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆè¡Œå·ï¼›ä½†å®ƒè¿˜å¿…é¡»èƒ½å¤Ÿ**è·³è¿‡**æŸäº›è¡Œçš„ç¼–å·ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨æ¥æŽ§åˆ¶**ä½•æ—¶é€’å¢žè¡Œå·**â€”â€”å› ä¸ºâ€œè®¡æ•°è¡Œæ•°â€å’Œâ€œç¼–å·è¡Œâ€æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è·³è¿‡ç©ºè¡Œï¼Œä½†**æ˜¯å¦ä»ç„¶è®¡æ•°**è¿™äº›ç©ºè¡Œï¼Ÿå¦‚å›¾ 4.1 æ‰€ç¤ºï¼Œè¿™ä¸¤ç§æ–¹å¼çš„åŒºåˆ«å¾ˆæ˜Žæ˜¾â€”â€”ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™åº”è¯¥ç”±ç”¨æˆ·è‡ªè¡Œé…ç½®ã€‚

> ![figure4-1](/img/learn-haskell-by-example/chapter4/figure4-1.png)
>
> å›¾ 4.1ï¼šä¸åŒæ–¹å¼çš„ç©ºè¡Œç¼–å·ï¼‰

æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç« å­¦åˆ°çš„ï¼Œé«˜é˜¶å‡½æ•°ï¼ˆhigher-order functionsï¼‰å¯ä»¥æŽ¥æ”¶å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™äº›å‚æ•°å‡½æ•°èƒ½å¤Ÿæœ‰æ•ˆåœ°å‚æ•°åŒ–å…¶è¡Œä¸ºã€‚
 ç”±äºŽæˆ‘ä»¬éœ€è¦ä¸ºâ€œä½•æ—¶å¿½ç•¥è¡Œâ€å’Œâ€œä½•æ—¶ç¼–å·â€å®šä¹‰å¤æ‚è§„åˆ™ï¼Œå› æ­¤è¿™æ­£æ˜¯ç¼–å†™**é«˜é˜¶å‡½æ•°**çš„å¥½æœºä¼šâ€”â€”
 è¿™ä¸ªå‡½æ•°å¯ä»¥æŽ¥æ”¶ä¸¤ä¸ªè°“è¯å‚æ•°ï¼Œåˆ†åˆ«æŽ§åˆ¶â€œä½•æ—¶é€’å¢žç¼–å·â€å’Œâ€œä½•æ—¶ç»™è¡Œç¼–å·â€ã€‚

### 4.1.2 éšè—è¾…åŠ©å‚æ•°ï¼ˆHiding auxiliary argumentsï¼‰

æˆ‘ä»¬å…ˆä»Žæœ€ç®€å•çš„æƒ…å†µå¼€å§‹â€”â€”ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œç»™**æ¯ä¸€è¡Œ**ç¼–å·ï¼Œä¸å¸¦ä»»ä½•æ¡ä»¶ã€‚ç„¶åŽæˆ‘ä»¬å†é€æ­¥æ”¹è¿›ã€‚å…ˆè€ƒè™‘ç±»åž‹ï¼šæˆ‘ä»¬æŽ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼ˆå³å„è¡Œæ–‡æœ¬ï¼‰ä½œä¸ºè¾“å…¥ï¼Œéœ€è¦ç”Ÿæˆå‰é¢å®šä¹‰çš„ `NumberedLines`ã€‚é‚£è¡Œå·è®¡æ•°å™¨è¯¥æ€Žä¹ˆå¤„ç†ï¼Ÿæˆ‘ä»¬è¦ä¸è¦æŠŠå®ƒä½œä¸ºå‚æ•°æš´éœ²å‡ºåŽ»ï¼Ÿç†æƒ³æƒ…å†µä¸‹ä¸åº”è¯¥â€”â€”å› ä¸ºæˆ‘ä»¬å¸Œæœ›ä»Ž 1 å¼€å§‹ç¼–å·ã€‚ä½†å¦‚æžœæˆ‘ä»¬æƒ³é€’å½’åœ°å®žçŽ°è¿™ä¸ªå‡½æ•°ï¼Œå°±å¿…é¡»æœ‰åŠžæ³•åœ¨é€’å½’è°ƒç”¨ä¸­ä¼ é€’â€œé€’å¢žåŽçš„è®¡æ•°å™¨â€ã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ª**åœ¨å¤–éƒ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„éšè—å‡½æ•°**ã€‚å¯ä»¥ä½¿ç”¨ `let` ç»‘å®šæ¥å®žçŽ°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

**ä»£ç æ¸…å• 4.2ï¼šåŒ…å«å±€éƒ¨å‡½æ•°å®šä¹‰çš„å‡½æ•°ç»“æž„**

```haskell
numberAllLines :: [String] -> NumberedLines
numberAllLines lines =
  let go :: Int -> [String] -> NumberedLines      -- #1 ä½¿ç”¨ `let` å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å‡½æ•°
      go counter lines = ...
   in go 1 lines                                 -- #2 è°ƒç”¨å±€éƒ¨å‡½æ•°
```

è¿™ä¸Žæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ `let` ç¨æœ‰ä¸åŒã€‚é‚£æ˜¯å› ä¸º `let` åœ¨ä¸Ž `do` è¡¨è¾¾å¼é…åˆä½¿ç”¨æ—¶çš„è¯­ä¹‰ä¸ä¸€æ ·ã€‚åœ¨**çº¯å‡½æ•°**ä¸­ï¼Œ`let` ç”¨æ¥åˆ›å»ºå±€éƒ¨å®šä¹‰ï¼ˆè¿™äº›å®šä¹‰å¯ä»¥äº’ç›¸å¼•ç”¨ï¼‰ï¼Œå¹¶é€šè¿‡ `in` å…³é”®å­—å°†å®ƒä»¬å¼•å…¥ä½œç”¨åŸŸï¼Œå¦‚å›¾ 4.2 æ‰€ç¤ºã€‚å®šä¹‰çš„é¡ºåºæ— å…³ç´§è¦ã€‚

> ![figure4-2](/img/learn-haskell-by-example/chapter4/figure4-2.png)
>
> å›¾ 4.2ï¼š`let` ç»‘å®šçš„è¯­æ³•ç»“æž„

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `let` åˆ›å»ºä¸€ä¸ªä¸åŒç±»åž‹ç­¾åçš„å†…éƒ¨å‡½æ•°ï¼Œç„¶åŽåœ¨ä¸»å‡½æ•°ä¸­è°ƒç”¨å®ƒã€‚å†…éƒ¨å‡½æ•°å¯ä»¥æ‹¥æœ‰æ¯”å¤–éƒ¨å‡½æ•°æ›´å¤šï¼ˆæˆ–å®Œå…¨ä¸åŒï¼‰çš„å‚æ•°ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨é€’å½’å‡½æ•°ä¸­**éšè—é»˜è®¤å‚æ•°**ï¼Œæ¯”å¦‚ä¸‹é¢ç¤ºä¾‹ä¸­çš„è®¡æ•°å™¨å˜é‡ã€‚

> ðŸ’¡ æ³¨æ„
>  å½“ä¸ºè¿™ç§å±€éƒ¨å‡½æ•°èµ·åæ—¶ï¼Œé€šå¸¸ä½¿ç”¨ `go` æˆ– `aux`ï¼ˆå³ auxiliary çš„ç¼©å†™ï¼‰ã€‚è¿™è¡¨ç¤ºè¯¥å‡½æ•°åªæ˜¯æŸä¸ªæ›´å¤§å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚

------

çŽ°åœ¨æˆ‘ä»¬å¯ä»¥é€’å½’åœ°å¢žåŠ è®¡æ•°å™¨äº†ã€‚æ¯æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¡Œå·æ˜ å°„ï¼Œå¹¶åœ¨è¡Œå·åŠ ä¸€åŽç»§ç»­å¤„ç†ä¸‹ä¸€è¡Œã€‚æœ€ç»ˆç»“æžœæ˜¯é€šè¿‡è¿žæŽ¥æ–°ç”Ÿæˆçš„æ˜ å°„ï¼ˆ`(Maybe Int, String)` å…ƒç»„ï¼‰ä¸Žé€’å½’è°ƒç”¨ç»“æžœæž„æˆçš„åˆ—è¡¨ã€‚

**ä»£ç æ¸…å• 4.3ï¼šç»™æ¯ä¸€è¡Œç¼–å·çš„å‡½æ•°**

```haskell
numberAllLines :: [String] -> NumberedLines
numberAllLines lines =
  let go :: Int -> [String] -> NumberedLines     -- #1 å±€éƒ¨å‡½æ•°çš„ç±»åž‹ç­¾å
      go _ [] = []                               -- #2 å½“è¾“å…¥ä¸ºç©ºåˆ—è¡¨æ—¶è¿”å›žç©ºåˆ—è¡¨ï¼ˆé€’å½’ç»ˆæ­¢æ¡ä»¶ï¼‰
      go counter (x : xs) = (Just counter, x) : go (counter + 1) xs -- #3ä¸ºå½“å‰è¡Œåˆ›å»ºæ–°çš„ç¼–å·æ˜ å°„ï¼Œå¹¶é€’å½’å¤„ç†å‰©ä½™è¡Œ
   in go 1 lines                                 -- #4 è°ƒç”¨è¾…åŠ©å‡½æ•°ï¼Œå¹¶ä¼ å…¥åˆå§‹è¡Œå· 1
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`go` å‡½æ•°åœ¨ç¬¬ä¸€ä¸ªæ¨¡å¼ä¸­ä½¿ç”¨äº†é€šé…ç¬¦ `_` ä½œä¸ºå‚æ•°ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºåœ¨è¿™ä¸€åˆ†æ”¯ï¼ˆç©ºåˆ—è¡¨æƒ…å†µï¼‰ä¸­ä¸éœ€è¦ä½¿ç”¨è®¡æ•°å™¨å˜é‡ï¼Œ
å› æ­¤æˆ‘ä»¬ä¸å¿…ä¸ºå®ƒå‘½åã€‚åœ¨ä¸éœ€è¦æŸä¸ªå‚æ•°æ—¶ä½¿ç”¨ `_` æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¹ æƒ¯ã€‚

------

#### **ç»ƒä¹ ï¼šè¡Œä¸Žå•è¯ï¼ˆLines and Wordsï¼‰**

`lines`ã€`unlines`ã€`words` å’Œ `unwords` æ˜¯å¤„ç†å­—ç¬¦ä¸²æ—¶éžå¸¸æœ‰ç”¨çš„å‡½æ•°ã€‚è¯·å°è¯•ä½¿ç”¨**é€’å½’å®šä¹‰**è‡ªè¡Œå®žçŽ°è¿™äº›å‡½æ•°ï¼è®°ä½ï¼Œ`String` å…¶å®žå°±æ˜¯ `Char` çš„åˆ—è¡¨ï¼Œå› æ­¤ä½ å¯ä»¥å¯¹å…¶è¿›è¡Œæ¨¡å¼åŒ¹é…ã€‚åŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `let` åœ¨å‡½æ•°ä¸­å¼•å…¥å¸¦æœ‰é¢å¤–å‚æ•°çš„å†…éƒ¨å®šä¹‰ï¼Œå¹¶é…åˆå®ˆå«ï¼ˆguardsï¼‰æ¥å®žçŽ°è¿™äº›åŠŸèƒ½ã€‚çŽ°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå¯ä»¥ç»™ä¼ å…¥çš„æ‰€æœ‰è¡Œç¼–å·çš„å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ GHCi ä¸­æµ‹è¯•å®ƒï¼š

```haskell
ghci> numberAllLines ["Hello", "", "World"]
[(Just 1,"Hello"),(Just 2,""),(Just 3,"World")]
```

